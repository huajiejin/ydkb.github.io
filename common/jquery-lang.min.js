!function(t){"use strict";var e,n;"function"==typeof define&&define.amd?define(["jquery","Cookies"],t):"object"==typeof exports?module.exports=t():(e=window.Lang,(n=window.Lang=t(jQuery,"undefined"!=typeof Cookies?Cookies:void 0)).noConflict=function(){return window.Lang=e,n})}(function(f,h){function t(){this._fireEvents=!0,this._dynamic={}}return t.prototype.init=function(t){var e,n,a,o=this;(t=t||{}).cookie=t.cookie||{},e=t.defaultLang,n=t.currentLang,a=t.allowCookieOverride,this.cookieName=t.cookie.name||"langCookie",this.cookieExpiry=t.cookie.expiry||365,this.cookiePath=t.cookie.path||"/",this._mutationCopies={append:f.fn.append,appendTo:f.fn.appendTo,prepend:f.fn.prepend,before:f.fn.before,after:f.fn.after,html:f.fn.html},f.fn.append=function(){return o._mutation(this,"append",arguments)},f.fn.appendTo=function(){return o._mutation(this,"appendTo",arguments)},f.fn.prepend=function(){return o._mutation(this,"prepend",arguments)},f.fn.before=function(){return o._mutation(this,"before",arguments)},f.fn.after=function(){return o._mutation(this,"after",arguments)},f.fn.html=function(){return o._mutation(this,"html",arguments)},this.defaultLang=e||"en",this.currentLang=e||"en",!a&&n||void 0===h||(t=h.get(this.cookieName))&&(n=t),f(function(){o._start(),n&&n!==o.defaultLang&&o.change(n)})},t.prototype.pack={},t.prototype.attrList=["title","alt","placeholder","href"],t.prototype.dynamic=function(t,e){void 0!==t&&void 0!==e&&(this._dynamic[t]=e)},t.prototype.loadPack=function(o,r){var i=this;if(!o||!i._dynamic[o])throw"Cannot load language pack, no file path specified!";fetch(i._dynamic[o]).then(function(t){if(t.ok)return t.json()}).then(function(t){if(i.pack[o]=t,i.pack[o].regex)for(var e,n=i.pack[o].regex,a=0;a<n.length;a++)2===(e=n[a]).length?e[0]=new RegExp(e[0]):3===e.length&&(e[0]=new RegExp(e[0],e[1]),e.splice(1,1));r&&r(!1,o,i._dynamic[o])}).catch(function(t){throw r&&r(!0,o,i._dynamic[o]),"Error loading language pack"+i._dynamic[o]})},t.prototype._start=function(t){for(var e,n=void 0!==t?f(t).find("[lang]"):f(":not(html)[lang]"),a=n.length;a--;)e=f(n[a]),this._processElement(e)},t.prototype._processElement=function(t){t.attr("lang")===this.defaultLang&&(this._storeAttribs(t),this._storeContent(t))},t.prototype._storeAttribs=function(t){for(var e,n,a=0;a<this.attrList.length;a++)e=this.attrList[a],t.attr(e)&&((n=t.data("langAttr")||{})[e]=t.attr(e),t.data("langAttr",n))},t.prototype._storeContent=function(t){var e;if(t.is("input"))switch(t.attr("type")){case"button":case"submit":case"hidden":case"reset":t.data("langVal",t.val())}else t.is("img")?t.data("langSrc",t.attr("src")):(e=this._getTextNodes(t))&&t.data("langText",e)},t.prototype._getTextNodes=function(t){var e=t.contents(),n=[];return f.each(e,function(t,e){3===e.nodeType&&n.push({node:e,langDefaultText:e.data})}),1===n.length&&(n[0].langToken=t.data("langToken")),n},t.prototype._setTextNodes=function(t,e,n,a){for(var o,r,i,s,c=/<[^>]+>/g,l=0;l<e.length;l++)if(s=(o=e[l]).langToken,i=f.trim(o.langDefaultText),s?r=this.translate(s,n,a):i&&0<i.length&&(r=this.translate(i,n,a)),c.test(r))t[0].innerHTML=r;else if(r)try{o.node.data=o.node.data.split(f.trim(o.node.data)).join(r)}catch(t){}else console&&console.log&&0<i.length&&console.log('Translation for "'+i+'" not found!')},t.prototype._translateAttribs=function(t,e,n){var a,o,r=t.data("langAttr")||{};for(a in r)r.hasOwnProperty(a)&&t.attr(a)&&(e!==this.defaultLang?(o=this.translate(r[a],e,n))&&t.attr(a,o):t.attr(a,r[a]))},t.prototype._translateContent=function(t,e,n){var a,o,r;this.defaultLang;if(t.is("input"))switch(t.attr("type")){case"button":case"submit":case"hidden":case"reset":o=t.data("langVal"),r=t.data("langToken")||o,a=this.translate(r,e,n),t.val(a)}else t.is("img")?(o=t.data("langSrc"),r=t.data("langToken")||o,a=this.translate(r,e,n),t.attr("src",a)):(o=t.data("langText"),(r=t.data("langToken"))?(a=this.translate(r,e,n))&&(t[0].innerHTML=a):o&&this._setTextNodes(t,o,e,n))},t.prototype.getLangDataFromElement=function(t){return t.data("langDefaultData")},t.prototype.change=function(a,o,r){var i=this,t=a===this.defaultLang,e=this.pack[a],n=this._dynamic[a];if(!t&&!e&&!n)throw r&&r("No language pack defined for: "+a,a,o),'Attempt to change language to "'+a+'" but no language pack for that language is loaded!';if(e||!n){for(var s,t=!1,e=this.currentLang,c=(this.currentLang!==a&&(this.beforeUpdate(e,a),t=!0),this.currentLang=a,void 0!==o?f(o).find("[lang]"):f(":not(html)[lang]")),l=c.length;l--;)(s=f(c[l])).data("langScanned")&&s.attr("lang")===a||(s.data("langScanned",!0),this._translateElement(s,a,this.getLangDataFromElement(s)));t&&this.afterUpdate(e,a),void 0!==h&&h.set(i.cookieName,a,{expires:i.cookieExpiry,path:i.cookiePath}),r&&r(!1,a,o)}else this.loadPack(a,function(t,e,n){t?r&&r("Language pack could not load from: "+n,a,o):i.change.call(i,a,o,r)})},t.prototype._translateElement=function(t,e,n){this._translateAttribs(t,e,n),"false"!==t.attr("data-lang-content")&&this._translateContent(t,e,n),t.attr("lang",e)},t.prototype.getDataAtPath=function(t,e,n){var a=e;if(e instanceof Array){for(var o=[],r=0;r<e.length;r++){var i=e[r];o.push(this.getDataAtPath(t,i))}return o}if(null==t)return n;if(!a)return t;if("string"!=typeof a)throw new Error("Path argument must be a string");if(-1===a.indexOf("."))return void 0!==t[a]?t[a]:n;if("object"!=typeof t)return void 0!==n?n:void 0;var s=a.split(".");c=t;for(var c,r=0;r<s.length;r++)if(!(c=c[s[r]])||"object"!=typeof c){r!==s.length-1&&(c=void 0);break}return void 0!==c?c:n},t.prototype._parseTemplate=function(t,e){if(!t||!e)return t;var n=t;if(t&&t.indexOf("${"))for(var a=/\${([\s\S]+?)}/g;r=a.exec(t);)var o=r[0],r=r[1],n=n.replace(o,this.getDataAtPath(e,r));return n},t.prototype.translate=function(t,e,n){var a="",o=e===this.defaultLang;return e=e||this.currentLang,this.pack[e]?((a=(a=this._parseTemplate(this.pack[e].token[t],{data:n}))||this._regexMatch(t,e))||o||console&&console.log&&console.log('Translation for "'+t+'" not found in language pack: '+e),a||t):t},t.prototype._regexMatch=function(t,e){var n,a,o,r,i,s=this.pack[e].regex;if(s)for(n=s.length,a=0;a<n;a++)if((i=(r=(o=s[a])[0]).exec(t))&&i[0])return t.replace(r,o[1]);return""},t.prototype.beforeUpdate=function(t,e){this._fireEvents&&f(this).triggerHandler("beforeUpdate",[t,e,this.pack[t],this.pack[e]])},t.prototype.afterUpdate=function(t,e){this._fireEvents&&f(this).triggerHandler("afterUpdate",[t,e,this.pack[t],this.pack[e]])},t.prototype.refresh=function(){this._fireEvents=!1,this.change(this.currentLang),this._fireEvents=!0},t.prototype._mutation=function(t,e,n){e=this._mutationCopies[e].apply(t,n),n=this.currentLang,t=f(t);return t.attr("lang")&&(this._fireEvents=!1,this._translateElement(t,this.defaultLang,this.getLangDataFromElement(t)),this.change(this.defaultLang,t),this.currentLang=n,this._processElement(t),this._translateElement(t,this.currentLang,this.getLangDataFromElement(t))),this._start(t),this.change(this.currentLang,t),this._fireEvents=!0,e},t});