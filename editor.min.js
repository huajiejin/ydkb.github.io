function update_indicator(e,a){if(e<8){indicator[e]=a,keymaps[2][0][0]=indicator[0]|indicator[1]<<8,keymaps[3][0][0]=indicator[2]|indicator[3]<<8,keymaps[4][0][0]=indicator[4]|indicator[5]<<8,keymaps[5][0][0]=indicator[6]|indicator[7]<<8;var t=$(`#indicator_dropdown_menu li[value=${indicator[e]}]`);t&&$("#indicator_dropdown-btn_"+e).text(t.text()).attr({"data-tooltip":t.attr("data-tooltip"),value:indicator[e]});var s=$("#indicator_dropdown-name_"+e).text()+" : "+$("#indicator_dropdown-btn_"+e).text();$("#keyboard-outline").find(".kbd-led.led"+e).attr("data-tooltip",s)}else{for(var o=new Array,n=0;n<4;n++){var i=keymaps[n+2][0][0];o[2*n]=255&i,o[2*n+1]=i>>8}for(n=0;n<8;n++)update_indicator(n,o[n])}7==e&&console.log(keymaps[2][0][0].toString(16),keymaps[3][0][0].toString(16),keymaps[4][0][0].toString(16),keymaps[5][0][0].toString(16))}function update_indicator_color(e,a){if(console.log("Set LED"+e+": #"+a),e<8){if("block"==$("#indicator-color-btn_"+e).css("display")){indicator_color[e]=a;var t=parseInt(a.substr(0,2),16),s=parseInt(a.substr(2,2),16),o=parseInt(a.substr(4,2),16);keymaps[e][0][1]=t|s<<8,keymaps[e][0][2]=65280&keymaps[e][0][2]|o,$("#indicator-color-btn_"+e)[0].jscolor.fromString(a),$("#indicator-color-btn_"+e).attr("value",a),$("#mykbd").find(".kbd-led.led"+e).each((function(){$(this).css("background-color","#"+a);var e=M.Tooltip.getInstance(this);e&&$(e.tooltipEl).find(".aug")[0].style.setProperty("--aug-border-bg","#"+a)})),$("#keyboard-ledmap").find("#indicator_dropdown-btn_"+e).each((function(){var e=M.Tooltip.getInstance(this);e&&$(e.tooltipEl).find(".aug")[0].style.setProperty("--aug-border-bg","#"+a)}))}}else for(var n=0;n<8;n++){var i=(255&keymaps[n][0][1])<<16|65280&keymaps[n][0][1]|255&keymaps[n][0][2];update_indicator_color(n,i=("000000"+i.toString(16)).substr(-6))}}function update_keycap_color(e){$.cookie?null==e&&$.cookie("ck_keycap_color")?e=$.cookie("ck_keycap_color").match(/#(.{6})/g):e&&6==e.length&&$.cookie("ck_keycap_color",e,{expires:365,path:"/"}):null==e&&now_keycap_color&&(e=now_keycap_color),null==e&&(e=["#575d5e","#e3d9c6","#ed6b21","#575d5e","#575d5e","#ed6b21"]),6==e.length&&(document.documentElement.style.setProperty("--color-mykeycap1",e[0]),document.documentElement.style.setProperty("--bgcolor-mykeycap1",e[1]),document.documentElement.style.setProperty("--color-mykeycap2",e[2]),document.documentElement.style.setProperty("--bgcolor-mykeycap2",e[3]),document.documentElement.style.setProperty("--color-mykeycap3",e[4]),document.documentElement.style.setProperty("--bgcolor-mykeycap3",e[5]),now_keycap_color=e,$("#keycap_color-user").find('[onchange^="update_keycap_color_single("]').each((function(){var a=$(this).attr("onchange").slice(27,28),t=e[a].slice(1,7);$(this)[0].jscolor.fromString(t),$(this).attr("value",t)})),$(".border .top").css("background-color","transparent"),$(".border .top").css("background-color",""))}function update_keycap_color_single(e,a){console.log("set color "+e+" to "+a),console.log(now_keycap_color),now_keycap_color[e]="#"+a,update_keycap_color(now_keycap_color),$("#user-keycap-colors").val(now_keycap_color)}function update_case_color(e){e&&6==e.length&&(e="#"+e),$.cookie?null==e?e=$.cookie("ck_case_color"):$.cookie("ck_case_color",e,{expires:365,path:"/"}):now_case_color&&(e=now_case_color),e&&($("#case_color_css").remove(),$(`<style id="case_color_css" type="text/css">.mycase{background-color: ${e}!important}</style>`).appendTo("head"),now_case_color=e)}function update_plate_color_user(e){6==e.length&&(e="#"+e,$("#plate_color_css").remove(),$(`<style id="plate_color_css" type="text/css">.plate{background-color: ${e}!important}</style>`).appendTo("head"),now_case_color=e)}function jsdef_init(){$(".jsdef").each((function(){var e=$(this).attr("class"),a=e.match(/(.*?)ml-(\d+)(.*?)/),t=e.match(/(.*?)pl-(\d+)(.*?)/),s=e.match(/(.*?)ht-(\d+)(.*?)/),o=e.match(/(.*?)wd-(\d+)(.*?)/),n=e.match(/(.*?)lh-(\d+)(.*?)/);a&&$(this).css({"margin-left":a[2]+"px"}),t&&$(this).css({"padding-left":t[2]+"px"}),s&&$(this).css({height:s[2]+"px"}),o&&$(this).css({width:o[2]+"px"}),n&&$(this).css({"line-height":n[2]+"px"})}))}function tooltip_init(){$(".tooltipped").tooltip({delay:50}),update_indicator_color(10)}function update_logo_desc(){var e=$("#firmware-dropdown-btn").attr("value"),a=$("#firmware-dropdown").find(`[value=${e}]`).attr("data-tooltip");$("#logo_desc").text(a)}function display_label(e,a){var t=new Action(e),s=new Action(255&e),o={name:t.name,desc:t.desc};if(e>49151&&e<65536){var n=$(`[kc="0x${e.toString(16)}"]`);n.length>0?(o.name=n.html(),o.desc=n.attr("title")):62464==(62718&e)?((o=display_label(64511&e,a)).name+="<sub>F4</sub>","zh_cn"==NOW_LANG?o.desc+=",<br>如果和<kt>左Alt</kt>一起时则执行<kt>Alt+F4</kt>":o.desc+="<br>If combined with <kt>LAlt</kt>, execute <kt>Alt+F4</kt>"):console4jslang&&(o.name="u"+e.toString(16))}if(e>=18176&&e<18432){var i=(255&e).toString(16);i=`0${i}`.substr(-2),o.name=`SC${i}`,o.desc=`Launch shortcut ${i}`}if(o.name.match(/.*?BS.*?/)&&$(`.key.k${a}:visible`).each((function(){$(this).parents(".border")[0].offsetWidth>86.4&&(o.name=o.name.replace("BS","Backspace"))})),$("#keycap_style_gmk.nowdsa")[0]&&(s.name_dsa?o.name=" "+t.name_dsa:o.name=" <i"==o.name.substr(0,3)||"<i"==o.name.substr(0,2)?o.name:o.name.toUpperCase()),is_mac&&!$("#keycap_style_gmk.nowdsa")[0]){if(o.name.match(/.*?Ctrl.*?/)&&$(`.key.k${a}:visible`).each((function(){$(this).parents(".border")[0].offsetWidth<=54&&(o.name=o.name.replace("Ctrl","short_ctl"))})),o.name.match("kb kb-"))return o;o=keylabel_mac(o),kc_alpha(e)||kc_numpad(e)?o.name=` <i class="bigfont"><div style="height:15px"></div><I>${o.name.replace(/<br>.*/g,"")}</I></i>`:kc_symbol(e)||kc_function(e)||e>=70&&e<=72?o.name=` <i class="midfont">${e<57?"":'<div style="height:15px"></div>'}<I>${o.name}<I></i>`:o.name=` ${o.name.match(/.*( |<br>).*/)?"":"<br>"}<I>${o.name.toLowerCase()}<I></i>`}else(kc_alpha(e)||kc_numpad(e))&&(o.name=` <span class="bigfont">${o.name}</span>`),(kc_symbol(e)||kc_function(e))&&(o.name=` <span class="midfont">${o.name}</span>`);return"en"==NOW_LANG&&(o.desc=window.jslang.translate(o.desc,"en")),$(`.key.k${a}:visible`).each((function(){$(this).closest(".border").parent().hasClass("round")&&(o.name=o.name.replace(/<br>/g," ").replace('<div style="height:15px"></div>',""))})),o}function kbd_name_filter(e){var a=e.toLowerCase();$("#firmware-dropdown").find("li:not(.optgroup)").each((function(e){$(this).css("display",($(this).text()+$(this).attr("data-tooltip")).toLowerCase().includes(a)?"block":"none")}))}function user_keycap_colors(e){console.log(e)}function gernerate_kbd_list(e,a,t){return`<li value="${e}" class="tooltipped tip_kbdlist" lang-id="kbdlist-${e}"  data-position="right" deta-delay="80" data-tooltip="${a}" lang="zh_sc"> <a lang="zh_sc">${t}<i class="material-icons fav-kbd" lang-id="kbdlist-fav" title="fav or not">favorite_border</i>`}function fav_kbd_list_refresh(){$.cookie&&($("#fav-kbd-list").find(".tooltipped").each((function(){var e=M.Tooltip.getInstance(this);e&&e.destroy(),$(this).remove()})),$("#firmware-dropdown").find(".myfav").each((function(){var e=$(this).parent().parent().attr("value");$("#fav-kbd-list").append(gernerate_kbd_list(e,CONFIG.kbd[e].desc,CONFIG.kbd[e].name)),$("#fav-kbd-list").find(`[value=${e}]`).each((function(){if($(this).find(".fav-kbd").addClass("myfav").text("favorite"),!M.Tooltip.getInstance(this))M.Tooltip.init(this)}))})))}function process_html_page(){for(var e in add_some_css_to_head(),update_copyright(),$("#fn-set").find("a").each((function(){if(this.id.match(/_dropdown-btn/)){var e=this.id.replace("-btn","");$(this).addClass("col dropdown-trigger btn-flat select tooltipped uicolor").attr({"data-target":e,"data-tooltip":$(this).text()}),$(this).next("ul").addClass("dropdown-content")}})),$(".waves-effect").addClass("waves-light"),CONFIG.kbd)e.match(/optgroup.*/)?$("#firmware-dropdown").append(`<li class="disabled optgroup uicolor-text"><span>${CONFIG.kbd[e].name}`):e.match(/.*hidden/)||$("#firmware-dropdown").append(gernerate_kbd_list(e,CONFIG.kbd[e].desc,CONFIG.kbd[e].name));if($.cookie&&$.cookie("fav_list")){var a=$.cookie("fav_list").split(" ");for(let e of a)e&&$("#firmware-dropdown").find(`[value=${e}]`).find(".fav-kbd").addClass("myfav").text("favorite")}fav_kbd_list_refresh();for(let e=0;e<8;e++)$("#ledmap-setting").append(`<div>                 <a id="indicator_dropdown-name_${e}" class="col mykeycap2" lang="zh_sc">LED${e}:</a>                 <a id="indicator_dropdown-btn_${e}" class='col dropdown-trigger btn select uicolor' data-target='indicator_dropdown_menu'>选择功能</a>                 <input id="indicator-color-btn_${e}" class="col btn jscolor" type="show"  onchange="update_indicator_color(${e},''+this.jscolor)" value="ff0000"> </div>`);for(let e=1;e<5;e++)e<4?$("#keycap_color-user-setting").append(`<div><a class="col mykeycap${e} key-flat" title="Keycaps1" lang="zh_sc">Main</a></div>                     <div><a lang="zh_sc">文字颜色</a><input class="col btn jscolor" type="show"  onchange="update_keycap_color_single(${2*(e-1)},''+this.jscolor)" value="ffffff"></div>                     <div><a lang="zh_sc">键帽颜色</a><input class="col btn jscolor" type="show"  onchange="update_keycap_color_single(${2*(e-1)+1},''+this.jscolor)" value="ffffff"></div>`):$("#keycap_color-user-setting").append('<div><a class="col mycase key-flat" style="padding: 6px" title="Keycaps3" lang="zh_sc"><span class="plate" style="width: calc(100% - 6px);height: calc(100% - 6px);"></span></a></div>                     <div><a lang="zh_sc" class="tooltipped" data-tooltip="建设中，切换键帽样式可以恢复到默认颜色">外壳颜色(dev)</a> <input class="col btn jscolor" type="show"  onchange="update_case_color(\'\'+this.jscolor)" value="ffffff"> </div>                     <div><a lang="zh_sc" class="tooltipped" data-tooltip="建设中，刷新页面可以恢复到默认颜色">定位板(dev)</a> <input class="col btn jscolor" type="show"  onchange="update_plate_color_user(\'\'+this.jscolor)" value="ffffff"> </div>');jscolor.installByClassName("jscolor"),$("#setting-pane .keyboard-set").find("li").each((function(e){if($(this).attr("kc")){var a=[{attr:"L",class:"low"},{attr:"S",class:"s1"},{attr:"R",class:"rowstart"},{attr:"A",class:"t1a"},{attr:"T",class:"t1"},{attr:"W",class:"name_win"},{attr:"M",class:"name_mac"}];for(var t in a)null!=$(this).attr(a[t].attr)&&$(this).addClass(a[t].class).removeAttr(a[t].attr);null==$(this).attr("class")&&-1==$(this).html().indexOf("<br>")&&$(this).addClass("t1"),$(this).addClass("key-set").attr("lang","zh_sc")}})),$("#setting-pane").find(".keys-category").attr("lang","zh_sc"),$("#indicator_dropdown_menu").find("li").attr("lang","zh_sc").addClass("tooltipped").attr("data-position","right").find("a").attr("lang","zh_sc"),$("#fn-set").find("a").attr("lang","zh_sc"),$("#keyboard-ledmap").find(".dropdown-trigger").addClass("tooltipped").attr("data-position","right"),$("#keyboard-ledmap").find('[id^="indicator_dropdown-name_"]').addClass("tooltipped").attr("data-position","left");for(let e=1;e<16;e*=2)$("#key_mods_dropdown,#layer_mods_dropdown").append(`<li class="optgroup-option"><span><label><input type="checkbox" value="${e}"><span>${mods_codes[e].name}</span></label></span></li>`);lang_init(),$(".key-set_shift_off, .key-set_shift_on").find("li").each((function(e){var a=$(this).html().match(/(.*)\<br\>(.*)/);a&&$(this).html(`<span class="t2_s">${a[1]}</span><br><span class="t2_l">${a[2]}</span>`)}))}function first_visit(){if($.cookie&&!$.cookie("ck_select_kbd")){if(0==document.location.search.substring(1).length){var e=document.querySelector("#nav-side");M.Sidenav.getInstance(e).open()}var a=document.querySelector("#kbdinfo_tab");M.Tooltip.getInstance(a).open()}}function kc_alpha(e){return e>3&&e<30}function kc_symbol(e){return e>29&&e<40||e>44&&e<57||100==e}function kc_function(e){return e>57&&e<70||e>103&&e<116}function kc_numpad(e){return e>83&&e<100&&88!=e||176==e}CONFIG={kbd:{optgroup0:{name:"YDKB ( High-end )"},"1800mini":{name:"1800mini",size:{X:16,Y:5.25,M:-24,BR:16},checksum:{value:6145,addr:65280}},"1800qaz":{desc:"1800QAZ",name:"1800QAZ",size:{X:12.25,Y:4.5,MU:-18,MR:-18,MD:-12,ML:-18},checksum:{value:8768,addr:26368}},master98:{name:"Master98 Pro",size:{X:19.5,Y:6.5,MU:-18,MR:-18,MD:-12,ML:-18},checksum:{value:6552,addr:65280}},sairo64:{name:"Sairo64",size:{X:15,Y:5,MU:-24}},taichi:{name:"TAICHI PAD",size:{X:4,Y:4,M:-24,BR:16}},x8086k:{name:"X-8086K",size:{X:18.25,Y:6.25,M:-24,BR:16}},hw75:{name:"瀚文75(HW75)",desc:"稚晖君 & Xikii 瀚文(Hello Word) 75% 尺寸开源键盘。本站固件由YANG@YDKB提供第三方友情支持。",firmware_url:"./config/hw75_uf2.hex",size:{MaskHeight:440,X:16.5,Y:6.5,M:-16}},optgroup1:{name:"YDKB (BLE系列键盘)"},aria:{name:"Aria",desc:"Layout test. 8deg rotation (not 12deg as Alice). Maybe not the final version.",firmware_url:"./config/louise.hex",size:{MaskHeight:375},checksum:{value:8513,addr:26368}},ble40:{name:"BLE40",firmware_url:"./config/ble40_blup.hex",size:{X:12,Y:4}},blup:{name:"BLUP",firmware_url:"./config/ble40_blup.hex",size:{X:12,Y:4}},cad66:{name:"CAD66",size:{X:16.5,Y:5.25,MU:-24,MR:-16,MD:-16,ML:-16}},chicory:{name:"Chicory",size:{X:12,Y:4}},d60ble_hidden:{name:"D60BLE",desc:"60% USB/BLE Hotswap PCB by YANG for D60 from KBDFans",size:{X:15,Y:5,M:-18,BR:9},checksum:{value:8545,addr:26368}},duang60:{name:"Duang60 v1",desc:"专为无钢或半钢设计的60%蓝牙双模焊接版PCB by YANG。单模版也使用此固件。",size:{X:15,Y:5,MU:-24},checksum:{value:8288,addr:26368}},duang60_v2:{name:"Duang60 v2",desc:"Duang60的热插拔版本，适配某些特定键盘如： Falcon / Fly60 / Rama Kara / S58m等",firmware_url:"./config/duang60_v2.hex",size:{X:15,Y:5,MU:-24},checksum:{value:8546,addr:26368}},fmini:{name:"Fmini",desc:"一个类似Kmini布局的PCB by YANG",size:{X:18.5,Y:5,MU:-32,MR:-16,MD:-16,ML:-16,BR:6}},hello_v1_hidden:{name:"Hello_v1",desc:"Hello Keyborad v1，支持多个键盘，包括HHKB改装，MX轴，ALPS轴等",size:{X:15,Y:5,MU:-24,MR:-18,MD:-18,ML:-18},checksum:{value:8556,addr:26368}},just60:{name:"Just60",desc:"60%蓝牙双模机械键盘 by YANG",firmware_url:"./config/just60_yd60ble.hex",size:{X:15,Y:5,MU:-24}},just66:{name:"Just66",desc:"USB/BLE 双模多配列PCB，仅v1.x支持CA66外壳。珈蓝PCJR的双模默认是此PCB。",firmware_url:"./config/just68.hex",size:{X:16.5,Y:5.25,MU:-24,MR:-16,MD:-16,ML:-16},checksum:{value:6502,addr:26368}},just660:{name:"Just660",desc:"USB/BLE 双模多配列PCB for Leopold FC660M",firmware_url:"./config/just68.hex",size:{X:16.5,Y:5,M:-18,BR:6}},just68:{name:"Just68 v1",desc:"USB/BLE 双模多配列键盘（兼容Tada68外壳和小门牙），焊接版",size:{X:16,Y:5}},just68v2:{name:"Just68 v2",desc:"USB/BLE 双模热插拔键盘，仅支持单空格和单配列，可带一个滚轮编码器",size:{X:16,Y:5},checksum:{value:8552,addr:26368}},louise:{name:"Louise",desc:"40% version of Alice, 适配外壳有 Curva40 / Reel40",firmware_url:"./config/louise.hex",size:{MaskHeight:320},checksum:{value:8513,addr:26368}},minira:{name:"Minira v1",desc:"60%蓝牙双模机械键盘 配列同Filco Minila",size:{X:15,Y:5,MU:-24}},minira_v2:{name:"Minira v2",desc:"支持双旋钮，60%蓝牙双模机械键盘，支持Minira配列和64配列，单模版也使用此固件。",size:{X:15,Y:5,MU:-24},checksum:{value:8544,addr:26368}},pearly:{name:"Pearly v1",desc:"40%蓝牙双模机械键盘PCB, v1焊接版兼容AQ40和Pearl外壳。",size:{X:13,Y:4,M:-24},checksum:{value:8256,addr:26368}},pearly_v2:{name:"Pearly v2",desc:"40%蓝牙双模机械键盘PCB，v2热插拔版，有12列和13列两种PCB，PISA外壳使用。",size:{X:13,Y:4,M:-20,BR:10},checksum:{value:8770,addr:26368}},taiga40:{name:"Taiga40",desc:"40%蓝牙双模机械键盘热插拔PCB，适配外壳 xx",size:{MaskHeight:320},checksum:{value:8771,addr:26368}},taiga:{name:"Test",desc:"40%蓝牙双模机械键盘，暂测试用途",firmware_url:"./config/louise.hex",size:{X:13,Y:4,M:-16,BR:10},checksum:{value:8771,addr:26368}},xikii104:{name:"Xikii i104",desc:"大爽全尺寸键盘",size:{X:23,Y:7,EY:-1.4,MU:-70,MR:-40,MD:-54,ML:-40,BR:18},checksum:{value:8608,addr:26368}},xikii_6x:{name:"Xikii i6x",desc:"小爽键盘",size:{X:16.5,Y:5,MU:-70,MR:-32,MD:-32,ML:-32,BR:12},checksum:{value:8550,addr:26368}},xikii_8x:{name:"Xikii i8x",desc:"中爽键盘",size:{X:18.5,Y:7,EY:-.5,MU:-70,MR:-40,MD:-54,ML:-40,BR:18},checksum:{value:8576,addr:26368}},yd60ble:{name:"YD60BLE",desc:"60%蓝牙双模机械键盘 by YANG",firmware_url:"./config/just60_yd60ble.hex",size:{X:15,Y:5,MU:-24}},yd67ble:{name:"YD67BLE",desc:"65% USB/BLE Hotswap PCB by YANG for KBD67 Lite from KBDFans",size:{X:16,Y:5,M:-18,BR:9},checksum:{value:8551,addr:26368}},yd81_hidden:{name:"YD81",desc:"Get more than 80%. 支持有线蓝牙双模",firmware_url:"./config/yd81.hex",layout:"./config/layout-yd81.html"},ydp50:{name:"YDP50",desc:"USB/BLE双模50% 无线键盘 by YANG",size:{X:12,Y:5}},ydpm40ble:{name:"YDPM40BLE",desc:"YDPM40 双模版",size:{X:12,Y:4}},optgroup2:{name:"YDKB (其他键盘)"},akb48:{name:"AKB48",desc:"Atreus Keyboard 48 by YANG",size:{MaskHeight:320}},cod67:{name:"COD67",desc:"COD67 PCB by YANG",size:{MaskHeight:370}},ergoplus_hidden:{name:"ErgoPlus",desc:"An ErgoDox layout keyboard with full RGB and hotswap",firmware_url:"./config/ergodone.hex",layout:"./config/layout-ergoplus.html"},eswn:{name:"ESWN"},hskb:{name:"HSKB",desc:"HSKB原型机一，分体有线带屏幕键盘",size:{X:16,Y:5,MU:-78,MR:-18,MD:-18,ML:-18}},kunlun:{name:"Kunlun",desc:"for KBDFans Kunlun",size:{MaskHeight:380},checksum:{value:8547,addr:26368}},mountain:{name:"Mountain",desc:"for KBDFans Mountain",size:{MaskHeight:380},checksum:{value:8547,addr:26368}},ns60:{name:"NS60",desc:"60%蓝牙双模机械键盘，同时支持上下灯位",size:{X:15,Y:5,MU:-24}},sasuke01:{name:"Sasuke No.01",desc:"佐助(辅佐助手)小键盘。此键盘目前更建议使用vial的固件(vial.ydkb.io有提供)",size:{MaskHeight:210},checksum:{value:8464,addr:26368}},simpo40:{name:"Simpo40",desc:"40% Keyboard.",firmware_url:"./config/simpo_uf2.hex",size:{X:12,Y:4}},simpo66:{name:"Simpo66",desc:"单模有线版PCB，支持CA66旧版外壳。珈蓝PCJR的单模默认是此PCB",firmware_url:"./config/simpo_uf2.hex",size:{X:16.5,Y:5.25,MU:-24,MR:-16,MD:-16,ML:-16}},simpo68:{name:"Simpo68",desc:"65% Keyboard. Just68的单模有线版本",firmware_url:"./config/simpo_uf2.hex",size:{X:16,Y:5}},stm60:{name:"STM60",desc:"60% Keyboard that uses STM32F103",size:{X:15,Y:5,MU:-24},firmware_url:"./config/stm60_uf2.hex"},stm60c:{name:"STM60.C",desc:"60% Keyboard that uses STM32F103",firmware_url:"./config/stm60_uf2.hex",size:{X:15,Y:5,MU:-24}},taco75:{name:"Taco75",desc:"KBDFans Taco75 Keyboard",firmware_url:"./config/unicore_f1_taco75_uf2.hex",layout:"./config/layout-kbdfans_taco75.html",size:{X:16,Y:6.25,M:-16}},thx30:{name:"THX30",size:{X:10,Y:3}},unicore_f1:{name:"UniCore-F1",desc:"UniCore-F1 DevBoard",firmware_url:"./config/unicore_f1_uf2.hex",layout:"./config/layout-unicore_f1.html",size:{MaskHeight:386}},uukb:{name:"UUKB",desc:"USB/优联 双模键盘",firmware_url:"./config/uukb_uf2.hex"},yd68:{name:"YD68",desc:"YD68双空格键盘，v2为单空格但支持蓝牙双模",size:{X:16,Y:5}},ydkb_u2u:{name:"YDKB优联",desc:"YDKB的优联键盘集合",size:{MaskHeight:310}},ydp60:{name:"YDP60",desc:"YDP60",size:{X:15,Y:5,MU:-24}},ydpm40:{name:"YDPM40",desc:"YDP40 双空格类Planck and YDM40 by YANG",size:{X:12,Y:4}},yxpad:{name:"YXPAD",size:{X:4,Y:6}},optgroup3:{name:"YDKB Mod"},apple_adb:{name:"Apple_ADB",desc:"Apple ADB Keyboard to USB",size:{MaskHeight:416}},ble660c:{name:"BLE660C",desc:"USB/BLE Controller for Leopold FC660C",firmware_url:"./config/ble660c_980c.hex",size:{X:16.5,Y:5,M:-18,BR:6},checksum:{value:6502,addr:26368}},ble980c:{name:"BLE980C",desc:"USB/BLE Controller for Leopold FC980C",firmware_url:"./config/ble660c_980c.hex",size:{X:19.5,Y:6.75,BR:6},checksum:{value:6502,addr:26368}},ble980m:{name:"BLE980M",desc:"Leopold FC980M USB/蓝牙4.0双模改装",size:{MaskHeight:451}},filco104:{name:"FILCO104",desc:"FILCO104 YDKB Conroller",size:{MaskHeight:416}},hhkb_ble:{name:"HHKB BLE",desc:"USB/BLE Controller for HHKB Professional / Professional 2 / Professional JP",size:{X:15,Y:5,MU:-24},checksum:{value:6499,addr:26368}},yd3000c_hidden:{name:"YD3000c",desc:"G80-3000系列的转换器，支持多种自定义功能，G80-3494支持USB下全键无冲",size:{MaskHeight:540}},optgroup4:{name:"K.T.E.C."},chili:{name:"Chili3000",desc:"K.T.E.C.成员 !#&*^$)~$#`^(%#$Gacathon 作品，G80-3000外壳可用PCB",firmware_url:"./config/lm_chili.hex",layout:"./config/layout-lm_chili.html",size:{X:23,Y:7,EY:-1.4,MU:-70,MR:-40,MD:-54,ML:-40,BR:18}},cw40:{name:"CW40",desc:"K.T.E.C.出品，国外设计，国内制造",size:{X:12,Y:4}},daisy:{name:"Daisy",desc:"K.T.E.C.出品，国外设计，国内制造",size:{X:12,Y:4}},ergodone:{name:"Ergodone",desc:"K.T.E.C.出品，国外设计，国内制造",size:{MaskHeight:460}},grape:{name:"Grape11900",desc:"K.T.E.C.成员 !#&*^$)~$#`^(%#$Gacathon 作品，G80-11900/11800外壳可用PCB",firmware_url:"./config/lm_grape.hex",layout:"./config/layout-lm_grape.html",size:{X:20,Y:8,EY:-1.6,MU:-48,MR:-48,MD:-60,ML:-48,BR:18}},leechee:{name:"Leechee1800",desc:"K.T.E.C.成员 !#&*^$)~$#`^(%#$Gacathon 作品，G80-1800外壳可用PCB",firmware_url:"./config/lm_leechee.hex",layout:"./config/layout-lm_leechee.html",size:{X:19.5,Y:7,EY:-1.5,MU:-54,MR:-40,MD:-54,ML:-40,BR:18}},staryu:{name:"Staryu",desc:"K.T.E.C.出品，国外设计，国内制造",size:{X:3,Y:2}},optgroup5:{name:"Others(第三方)"},ca66:{name:"CA66",desc:"CA66有线版，适用于2020年之前的有线版CA66。2020及之后的，使用若遇软件或硬件问题，自行解决。",size:{MaskHeight:480}},diyer72:{name:"Diyer72",desc:"YDKB's firmware for Diyer72 / Xikii72 Keyboard",size:{MaskHeight:385.5}},exe_hidden:{name:"EXE",desc:"E神作品，国内客制化先驱"},gh60:{name:"GH60_ABC",desc:"该固件主要给添加了UART2BT蓝牙模块的使用， 完整支持XD60v2，其他ABC版本自测。",size:{X:15,Y:5,MU:-24}},u2u_pro:{name:"U2U PRO",desc:"USB2USB Converter with AT90USB1286",size:{MaskHeight:440}},udock:{name:"UDock",desc:"UDock by Yock and Bobnaive",size:{MaskHeight:514}}}},KEYCAP_COLORS=[{name:"Hana",value:["#a598c5","#efefea"],case_color:"#ebc3f0"},{name:"HHKB",value:["#222222","#eae6e7","#cbcdda"],order:[0,1,0,2,0,2]},{name:"RF 10th",value:["#222222","#989793","#6688aa"],order:[0,1,0,2,0,2],case_color:"#333333"},{name:"Raindrop",value:["#0073a2","#e5e4df"]},{name:"Carbon",value:["#575d5e","#e3d9c6","#ed6b21"],order:[0,1,2,0,0,2],case_color:"#424848"},{name:"Honeywell",value:["#212224","#efefea","#575757","#b01c11"],order:[0,1,1,2,1,3]},{name:"Hyperfuse",value:["#6c3b7b","#c4c4c0","#5dceba","#63696a"],order:[0,1,2,3,2,3]},{name:"Granite",value:["#525554","#e6e8e3","#222222","#a0a4a7"],order:[0,1,2,3,2,3]},{name:"Jukebox",value:["#a51b1b","#d9c9a8","#69d0a5"],order:[0,1,0,2,1,0]},{name:"Valentine",value:["#dc90bc","#efefea"],case_color:"#eaa0ca"},{name:"EVA 01",value:["#93c247","#592254"]},{name:"Pulse",value:["#00a6b4","#212224"]},{name:"Royal Navy",value:["#2f3d6f","#f0f0f0","#a92f0d"],order:[0,1,1,0,1,2]},{name:"Dolch",value:["#e4dedd","#5f5c52","#333430","#00a4a9"],order:[0,1,0,2,0,3]},{name:"Classic Olivetti",value:["#0965ed","#f5f5f5","#cfcdc2"],order:[0,1,0,2,1,0]},{name:"Lime",value:["#93c247","#e5e4df","#7c878e"],order:[0,1,1,2,1,0]},{name:"Eve",value:["#333333","#d4d0c7","#2785db"],order:[0,1,2,0,1,2]},{name:"Godspeed",value:["#666666","#d3cdc1","#6a94b1","#f9eb74"],order:[0,1,1,2,0,3]},{name:"Bentō",value:["#487992","#fff4f0","#f8767e"],order:[0,1,2,0,1,2]},{name:"Jamón",value:["#f2ebd7","#8c303a","#b2343c","#424446"],order:[0,1,0,2,3,0]},{name:"White on Black",value:["#efefea","#222222"],order:[0,1,0,1,0,1]},{name:"βeta",value:["#333333","#dcd6c4","#727473","#dd7632"],order:[0,1,0,2,0,3]},{name:"DMG",value:["#1d1770","#d1cdca","#7f8389","#722158"],order:[0,1,0,2,1,3]},{name:"Shiko",value:["#7a99ac","#dde5ed","#a1d1ee"],order:[0,1,1,0,1,2]},{name:"Olivia++",value:["#222222","#e1dbd1","#373634","#e0b19f"],order:[0,1,3,2,0,3]},{name:"Olivia dark",value:["#e0b19f","#222222"],order:[0,1,0,1,1,0]},{name:"Oblivion",value:["#dedeca","#6b7273","#474946","#297fa9"],order:[0,1,0,2,0,3]},{name:"Oblivion W",value:["#dedeca","#e7e8e5","#474946","#297fa9"],order:[2,1,0,2,0,3]},{name:"Symbiosis",value:["#e5e4df","#747b7b","#0073a2","#ffac00"],order:[0,1,0,2,2,3],case_color:"c4d0d0"},{name:"Posh Blue",value:["#222d5a","#e1dbd1","#d8a0a6"],order:[0,1,2,0,0,2]},{name:"Posh Pink",value:["#222d5a","#e1dbd1","#d8a0a6"],order:[0,1,0,2,2,0]},{name:"Pitta",value:["#333333","#eee6d3","#ccc0a6","#3cdcc6"],order:[0,1,0,2,0,3]}],UI_THEME=[{name:"默认主题",color:"#0288d1"},{name:"红色主题",color:"#e57373"},{name:"粉色主题",color:"#f06292"},{name:"紫色主题",color:"#7e57c2"},{name:"青色主题",color:"#00acc1"},{name:"绿色主题",color:"#4caf50"},{name:"暗黑模式",color:"#242424"}],$((function(){is_mac=navigator.platform.includes("Mac");var e,a,t,s=!0,o=0,n="1800mini",i=0,d=255,c="gmk";now_keycap_color=[],iscasejscolor=0,layouts_save="",is_dev=0,is_xikiicom=0;var r=0,l="",_=Array.from(transparent_map());indicator=Array(8).fill(0),indicator_color=Array(8).fill(0);var m=document.location.search.substring(1),u=m.match(/(.*)-(\d+)/);u?(variant=u[1],layouts_save=u[2]):variant=m,lang_pre_action();var p=0,f=url_decode_keymap(document.location.hash.substring(1).replace(/YDKB/g,"+"));function y(e){var a=CONFIG.kbd[e];if(a){$("#firmware-dropdown-btn").html(`<i class="material-icons fl">keyboard</i>${a.name}`).attr({value:e}),$("#logo_name, #kbdinfo_tab_name").text(a.name),update_logo_desc(),a.layout||(a.layout=`./config/layout-${e}.html`),a.firmware_url||(a.firmware_url=`./config/${e}.hex`),$("#keyboard-outline").css("display",""),$("#keyboard-ledmap").css("display","none"),$("#firmware-dropdown").find("li.uicolor").removeClass("uicolor"),$("#firmware-dropdown").find(`[value=${e}]`).addClass("uicolor"),$("#layouts-set-div, #layouts-set-on2").hide(),$("#layouts-set-on").addClass("scale-out");var t=a.size;if(t){var s=t.M?t.M:t.MU?t.MU:-12,o=t.M?t.M:t.MD?t.MD:-12,n=54*t.Y-s-o+24;t.EY&&(n+=54*t.EY),t.MaskHeight&&(n=t.MaskHeight),$("#keyboard-outline").html(`<div class="keyboard-mask page-wd" style="height: ${n}px;"></div><div style="height:${n-30}px;"</div>`);var i=54*t.Y/128,d=n/2-30,c=640;t.MaskHeight&&(c=640-1/(i=(t.MaskHeight-60)/128)*64),$("#loading").css({top:d+"px",left:c+"px",transform:`scale(${i})`}),$("#loading").show()}G(a.layout)}}function k(){$("#keyboard-outline").css("display","none"),$("#keyboard-ledmap").css("display","block"),$("#keyboard-outline").find(".key").empty()}null!=f&&(keymaps=f,p=1),window.onfocus=function(){},window.onblur=function(){$("#tabs-main").find(".keydown").removeClass("keydown"),r=0},$("#kbd-name-filter").bind("input propertychange",(function(){kbd_name_filter($(this).val())})),$("#user-keycap-colors").bind("input propertychange",(function(){user_keycap_colors($(this).val())})),$("#key-set-tabs").on("click","li a",(function(){var a=$(this).attr("href");"#tabs-kbdinfo"==a?($("#keyboard-outline").find(".keyboard-mask").removeClass("hidef"),$("#keyboard-outline").find(".key-editing").removeClass("key-editing"),e=null,$("main").removeClass("editing-key"),$("#keyboard-outline").find(".bl-key").css("z-index","12").find(".plate").css("background","red")):($("#keyboard-outline").find(".keyboard-mask").addClass("fade-out"),setTimeout((function(){$("#keyboard-outline").find(".keyboard-mask").removeClass("fade-out").addClass("hidef")}),50),$("#keyboard-outline").find(".bl-key").css("z-index","").find(".plate").css("background","")),a.match(/#tabs-readme|#tabs-kbdinfo|#tabs-keycap/g)?($("#fn-set-row").hide(),$("#keycode_tabs").css("height","397px")):($("#fn-set-row").show(),$("#keycode_tabs").css("height","336px")),$("#key-set-tabs .indicator").html($(this)[0].innerHTML)})),$("#firmware-dropdown").on("click","li",(function(){var e=$(":hover");if(0==e[e.length-1].outerHTML.indexOf("<a ")){var a=$(this).attr("value");CONFIG.kbd[a]&&n!=a&&(n=a,layouts_save="",y(n),$.cookie&&$.cookie("ck_select_kbd",n,{expires:365,path:"/"}))}else if(e[e.length-1].outerHTML.includes("fav-kbd")&&$.cookie){var t=$.cookie("fav_list"),s=$(this).attr("value"),o=s+" ";if(null!=t&&" "!=t||(t=""),$(this).find(".fav-kbd").hasClass("myfav")){$("#firmware-dropdown").find(`[value=${s}]`).find(".fav-kbd").each((function(){0==$(this).closest("#fav-kbd-list").length&&$(this).removeClass("myfav").text("favorite_border")}));var i=new RegExp(o,"g");t=t.replace(i,"").replace(/undefined/g,"").replace(/  /g,"")}else $(this).find(".fav-kbd").addClass("myfav").text("favorite"),t+=o;fav_kbd_list_refresh(),$.cookie("fav_list",t,{expires:365,path:"/"})}})),$("#layouts-set-border, #keycap_color-userset-border").drags(),$("#layouts-set-on, #layouts-set-off, #layouts-set-on2").click((function(){fadeToggle($("#layouts-set-border")[0])})),$("#keycap_color-userset-on, #keycap_color-userset-off").click((function(){fadeToggle($("#keycap_color-userset-border")[0])})),$("input.jscolor, textarea.not_drag").on("mousemove",(function(e){$(this).addClass("no_drag")})),$("input.jscolor, textarea.not_drag").on("mouseout",(function(e){$(this).removeClass("no_drag")})),$(document).ready((function(){for(var e of(process_html_page(),$(".sidenav").sidenav(),$(".collapsible").collapsible(),$(".modal").modal(),$(".dropdown-trigger").dropdown({coverTrigger:!1}),$("#keymap-load-dropdown-btn, #download-share-dropdown-btn").dropdown({constrainWidth:!1,coverTrigger:!1}),$("#fn-set .dropdown-trigger").dropdown({closeOnClick:!1}),$(".fixed-action-btn.toolbar").floatingActionButton({toolbarEnabled:!0}),$(".fixed-action-btn.tips").floatingActionButton({hoverEnabled:!1,direction:"right"}),$(".fixed-action-btn.tips").find(".scale-transition").removeClass("scale-out"),KEYCAP_COLORS)){e.order||(e.order=[0,1,1,0,1,0]);for(var a=new Array(0,0,0,0,0,0),t=0;t<6;t++)a[t]=e.value[e.order[t]];var s="";function o(e,a,t,s){return`<li class="key-color key-${e}" style="color:${a}; background:${t}">${s}</li>`}e.case_color&&(s=`case-color="${e.case_color}"`),$("#keycap-color-list").append(`<div class="keycap-color-block" ${s}>`+o("main",a[0],a[1],"key")+o("enter",a[4],a[5],"enter")+o("mod",a[2],a[3],e.name)+"</div>")}for(let n of UI_THEME)$("#ui-theme").append(`<li style="color:#fefefe; background-color:${n.color};"><a lang="zh_sc">${n.name}`);fetch("./common/case_list.txt").then(checkResponse).then(parseTEXT).then((function(e){let a=e.split("\r\n");a.pop();for(let e of a)$("#mycase-style ul").append(`<li style="background-image: url(./common/case/${e}"><a>`)})),jsdef_init(),J(is_mac),Y(0),W(),update_keycap_color(),j(),update_case_color(),X(),$("#setting-pane").show(),$(".tabs").tabs()})),$(".fixed-action-btn.tips").on("mousedown","ul li",(function(e){s=$(this).children().hasClass("green"),$("#layer_set").tabs("select","layer_0")})),$("#keycap-color-list").on("click",".keycap-color-block",(function(){now_keycap_color[0]=$(this).find(".key-main").css("color"),now_keycap_color[1]=$(this).find(".key-main").css("background"),now_keycap_color[2]=$(this).find(".key-mod").css("color"),now_keycap_color[3]=$(this).find(".key-mod").css("background"),now_keycap_color[4]=$(this).find(".key-enter").css("color"),now_keycap_color[5]=$(this).find(".key-enter").css("background");for(var e=0;e<6;e++){var t=now_keycap_color[e].match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(t){function s(e){return("0"+parseInt(e).toString(16)).slice(-2)}now_keycap_color[e]=`#${s(t[1])}${s(t[2])}${s(t[3])}`}}update_keycap_color(now_keycap_color),iscasejscolor||(a=$(this).attr("case-color")?$(this).attr("case-color"):now_keycap_color[1],$.cookie&&$.cookie("ck_case_color",a,{expires:365,path:"/"}),update_case_color(a))})),$("#casejscolor-toggle").click((function(){iscasejscolor=$(this).prop("checked"),$("#casejscolor-btn")[0].type=iscasejscolor?"show":"hidden"})),$("#ui-theme").on("click","li",(function(){W($(this).css("background-color"))})),led_setting=20,$("#ledmap-setting").on("click",'[id^="indicator_dropdown-btn_"]',(function(){led_setting=this.id.replace("indicator_dropdown-btn_","");for(let a of[{class_name:"can_disable",led_action_id:255},{class_name:"conn_mode",led_action_id:22},{class_name:"io_bt",led_action_id:20},{class_name:"io_ws2812",led_action_id:30}]){var e=$("#kb_ledmap-"+led_setting).hasClass(a.class_name)?"block":"none";$("#indicator_dropdown_menu").find(`[value=${a.led_action_id}]`).css({display:e})}})),$("[id^='indicator_dropdown_']").on("click","li",(function(){update_indicator(led_setting,this.value)})),$("[id^='layouts-']").on("click","[class^='layouts-']",(function(){var e=this.id.match(/layouts-(\d)(\d)/);if($("#kblayouts-00").length>0){for(var a=0;a<$("div[id^='kblayouts-"+e[1]+"']").length;a++)$("#keyboard-outline").find(".akblayouts-"+e[1]+a).each((function(){$(this).hide()})),$("#kblayouts-"+e[1]+a).hide();$("#keyboard-outline").find(".akblayouts-"+e[1]+e[2]).each((function(){$(this).show()})),$("#kblayouts-"+e[1]+e[2]).show()}var t=layouts_save.match(/(\d)/g);layouts_save="",$("div[id^='kblayouts-']").each((function(){if("block"==$(this).css("display")){var e=this.id.match(/kblayouts-(\d)(\d)/),a=e[1],s=e[2];t[a]=s}}));for(a=0;a<t.length;a++)layouts_save+=t[a];keymaps[1][0][0]="1"+layouts_save>>16,keymaps[0][0][0]="1"+layouts_save&65535,$("#keyboard-outline").find(".keyboard-mask").addClass("hidef"),h()})),$("#mykeycap_change li a").click((function(){j(c=$(this).attr("value"))})),$("#lock_shift").click((function(){let e=$(this).hasClass("fa-unlock");$(this).toggleClass("fa-unlock",!e).toggleClass("fa-lock",e),$('#tabs-main [kc="225"').toggleClass("shift_locked",e),$(".key-set_shift_on").css("display",e?"block":"none"),$(".key-set_shift_off").css("display",e?"none":"block")})),$("#mykeycap_system_change").click((function(){"gmk"!=c&&j(c="gmk"),is_mac^=1,J(is_mac)})),$("#case-style-set").click((function(){$(".sidenav").sideNav("show")})),$("#mycase-style ul").on("click","li",(function(){X($(this).css("background-image"))})),$(".layer").click((function(e,a){$("#keyboard-outline").css("display",""),$("#keyboard-ledmap").css("display","none");var t=parseInt($(this).attr("id").match(/layer-(\d+)/)[1]),s=t<i?"up":"down";i=t,$("#layer_set .indicator").text($(this).text().toUpperCase()),$("#keyboard-outline").find(".keyboard-mask").addClass("hidef"),$("#keyboard-outline").find(".key").each((function(){$(this).removeClass("fade-in-down fade-in-up").addClass(`fade-out-${s}`).removeAttr("length stabilizer")})),setTimeout((function(){$("#keyboard-outline").find(".key").each((function(){$(this).removeClass("fade-out-down fade-out-up").addClass(`fade-in-${s}`)})),setTimeout((function(){$("#keyboard-outline").find(".key").removeClass("fade-in-down fade-in-up")}),400),h(keymaps[t])}),350),$("#keymap-layer-clear").hasClass("recovery")&&$("#keymap-layer-clear").removeClass("recovery").text("清空当前层设置")})),$("#ledmap-tab").click((function(e,a){$("#layer_set .indicator").text($(this).text().toUpperCase()),k()})),$("#keyboard-outline").on("click",".kbd-led",(function(e){var a=$(this).attr("class").match(/.*led(\d).*/);a&&a[1]<8&&(k(),$("#layer_set").tabs("select","ledmap_tab"))}));var h=function(e){for(var a in null==e&&(e=keymaps[i]),$("#this_layout_keys").text("0"),$("#layout-info-pane").hasClass("showf")&&$("#layout-info-pane").removeClass("showf").addClass("hidef"),e)for(var t in e[a]){var s=e[a][t],o=parseInt(a).toString(32)+parseInt(t).toString(32),n=display_label(s,o);$(".key.k"+o).each((function(){$(this).html(n.name).attr("data-tooltip",n.desc),T($(this)[0],s)}))}},b=0,g=new Audio("sound/key_hover.wav");$("#keyboard-outline").on("mouseover mouseout",".key",(function(e){var a=$(this).attr("class").match(/k([0-9a-v][0-9a-v])/i),t=parseInt("0x"+a[1]);if(128!=t){var o=$(":hover"),n=keymaps[i][t>>4][15&t];"mouseover"==e.type&&(n>255||0==n)&&o[o.length-1].classList.contains("key")?s&&0==b&&(b=t,g.pause(),g.currentTime=0,g.play()):"mouseout"==e.type&&0==o.hasClass("key")&&(b=0)}})),$("#keyboard-outline").on("mouseover mouseout","[class^=mykeycap]",(function(e){var a=$(this).find(".key"),t=a.attr("class").match(/k([0-9a-v][0-9a-v])/i),o=parseInt("0x"+t[1]);if(128!=o){var n=keymaps[i][o>>4][15&o];"mouseover"==e.type&&(n>255||n<2)?(s||$("#keyfunction-display").html(a.attr("data-tooltip").replace("<br>","")).removeClass("hidef"),e.altKey&&($("#keyfunction-display")[0].innerHTML+=`  Code:0x${n.toString(16).toUpperCase()}`)):"mouseout"==e.type&&$("#keyfunction-display").addClass("hidef")}})),$("#keycode_tabs").on("mouseover mouseout",".key-set",(function(e){var a=$(this),t=a.attr("kc");"mouseover"==e.type&&(t>255||t<2)?$("#keyfunction-display").html(a.attr("title")).removeClass("hidef"):"mouseout"==e.type&&$("#keyfunction-display").addClass("hidef")})),$("#layer_set").on("mouseover mouseout",".layer",(function(e){var a=parseInt($(this).attr("id").match(/layer-(\d+)/)[1]);a!=i&&"gmk"==c&&(d=a,"mouseover"==e.type?(e.shiftKey&&($("#layer_set").find(".bottom").removeClass("bottom"),$(this).addClass("bottom")),$("#keyboard-outline").find(".key:visible").each((function(){var e,t=this.className.match(/k([0-9a-v])([0-9a-v])/i);t[1]<8&&(e=keymaps[a][parseInt(t[1],32)][parseInt(t[2],32)]);var s=display_label(e,t[0]);s.name=s.name.replace(/fs(\d+)/g,"fs10").replace(/midfont/g,"bottomfont").replace(/bigfont/g,"bottomfont").replace(/<br>/g," ").replace("font-size","nofont").replace('<div style="height:15px"></div>',""),$(this).find(".bottom_content").remove();var o=this.title;$(this).append(`<span class="bottom_content">${s.name}`),$(this).attr("title",o)}))):"mouseout"==e.type&&(e.shiftKey?(console.log("keep layer "+a),$("#layer_set").find(".layer").each((function(){console.log(this.id),this.id=="layer-"+a?$(this).addClass("bottom"):$(this).removeClass("bottom")}))):(d=255,$("#keyboard-outline").find(".bottom_content").remove(),$("#layer_set").find(".bottom").removeClass("bottom"))))})),$("#layouts-set").on("mouseover mouseout","label span",(function(e){var a=$(this).attr("for");console.log(a);var t=$("#keyboard-outline").find("#kb"+a);t&&("mouseover"!=e.type||$("#layouts-set").find("#"+a).prop("checked")?"mouseout"==e.type&&($("#keyboard-outline").find(".keyboard-mask").addClass("hidef"),t.find("[class^=mykeycap]").each((function(e){$(this).css("z-index","")})),$("#layouts-set").find("#"+a).prop("checked")||t.hide()):($("#keyboard-outline").find(".keyboard-mask").removeClass("hidef"),t.show(),t.find("[class^=mykeycap]").each((function(e){$(this).css("z-index","12")}))))})),$("#keycode_tabs").on("click",".key-set",(function(a,t){var s=parseInt($(this).attr("kc"));if(r&&s<152&&(s|=(15&r)<<8),4==r&&61440==(61694&s)&&s>=61696&&(s|=r<<8),Y(s),s<=255&&($("#tabs-main").find(`[id=code-${s}]`).each((function(e){$(this).removeClass("keydown")})),s>=224&&s<=229&&(r&=~(1<<s-224))),e){ani_fly_button(s,{top:a.pageY,left:a.pageX}),$(this).blur(),C(s)}else{var o=lang_from_json("select_key_first");M.toast({html:o,classes:"rounded",displayLength:"1000"})}}));var v=0,A=0,E=0;document.addEventListener("keydown",(function(a){var t=a.keyCode,s=keyCode2tmkCode(256*a.location+t);230==s&&(v&&(A=1),15!=r&&23!=r||(v=1));if(A)s>=224&&s<=229&&(r|=1<<s-224),a.returnValue=!1;else if(console.log(`KeyDN:js keycode: 0x${(256*a.location+t).toString(16)}. Key:${[tmkCode2keyName(s)]}`),$("#tabs-main").find(`[kc=${s}]`).each((function(e){$(this).addClass("keydown")})),s>=224&&s<=229&&(r|=1<<s-224),$(":hover").length>4&&"keyboard-outline"==$(":hover")[4].id){if(a.returnValue=!1,!e)return;if((s<224||s>=228)&&!r)ani_fly_button(s,getElementAbsPos($("#tabs-main").find(".keydown")[0])),C(s)}})),document.addEventListener("keyup",(function(a){var t=a.keyCode,s=keyCode2tmkCode(256*a.location+t),o=r;if(230==s&&A){A=0,r=0;var n,i,d,c=parseInt(E/4);if(n=parseInt(c/128),i=parseInt(c/16)%8,d=c%16,0==E&&(D=[no_map(),no_map(),no_map(),no_map(),no_map(),no_map(),no_map(),no_map()]),E%4==0?5==o?(E+=3,D[n][i][d]=1):6==o?(E++,D[n][i][d]=0):D[n][i][d]|=o:E%4==1?D[n][i][d]|=o<<2:E%4==2?6==o?R++:D[n][i][d]|=o<<8:E%4==3&&(D[n][i][d]|=o<<10),E%4==3){var l=("0000000000000000"+D[n][i][d].toString(2)).slice(-16),_=("0"+parseInt(E/40.95)).slice(-2);$("#keyfunction-display").removeClass("hidef").html(`接收完成前请勿操作电脑，接收按键设置 <span style='font-family:"Consolas", Sans-serif'> ${_}%  KEY[${n}][${i}][${("0"+d).slice(-2)}]: ${l}</span>`)}4096==++E&&($("#keyfunction-display").html("接收按键完成"),$("#keyfunction-display").addClass("hidef"),E=0,v=0,I()),a.returnValue=!1}else if(0==E){var m;if(console.log(`KeyUP:js keycode: 0x${(256*a.location+t).toString(16)}. Key:${tmkCode2keyName(s)}`),$("#tabs-main").find(`[kc=${s}]`).each((function(e){m=$(this),$(this).removeClass("keydown")})),s>=224&&s<=229&&(r&=~(1<<s-224)),$(":hover").length>4&&"keyboard-outline"==$(":hover")[4].id){if(a.returnValue=!1,!e)return;if(o&&s<224){var u=r<<8|s;ani_fly_button(u,getElementAbsPos(m[0])),C(u)}!r&&(70==s||s>=224)&&C(s)}}})),document.oncontextmenu=function(e){var a=$(":hover");if(e.altKey&&a.length>6)for(var t=6;t<a.length-1;t++){var s=a[t].className.match(/mykeycap(\d)/);if(s){var o=$('[class="'+a[t].className+'"]'),n=parseInt(s[1])+1;return n>3&&(n=1),o.removeClass(s[0]).addClass("mykeycap"+n),!1}}if(a.length>8&&"kind_dropdown"==a[a.length-3].id){var i=a[a.length-2].dataset.helplink;return window.open("help/#/"+i,"_blank"),!1}};var w=function(a){var t=e.match(/k([0-9a-v])([0-9a-v])/i);if(!t)throw"invalid id";return{row:parseInt(t[1],32),col:parseInt(t[2],32)}},C=function(a){var t=$("#keyboard-outline").find(".key-editing");if(t&&e){r&&a>=2&&a<=255&&(a|=r<<8);var s=w(),o=parseInt(s.row).toString(32)+parseInt(s.col).toString(32);keymaps[i][s.row][s.col]=a,!0;new Action(a);var n=display_label(a,o),c=n.name,l=n.desc;if(d<8&&d!=i){var _=display_label(keymaps[d][s.row][s.col],o);_.name=_.name.replace(/fs(\d+)/g,"fs10").replace(/midfont/g,"bottomfont").replace(/bigfont/g,"bottomfont").replace(/<br>/g," ").replace("font-size","nofont").replace('<div style="height:15px"></div>',""),c+=`<span class="bottom_content">${_.name}`}$("."+e).each((function(){var e=$(this);e.removeClass("fade-in-down fade-in-up").addClass("fade-out-down"),setTimeout((function(){e.removeClass("fade-out-down fade-out-up").addClass("fade-in-down").html(c),setTimeout((function(){e.removeClass("fade-in-down fade-in-up")}),350)}),300)})),$("."+e).attr("data-tooltip",l);var m=t.find(".key");m&&T(m[0],a),$("."+e).focus(),$("#keyboard-outline").find(".key-editing").removeClass("key-editing"),$("main").removeClass("editing-key"),e=null}};function T(e,a){var t=M.Tooltip.getInstance(e),o=e.parentElement.parentElement.parentElement.classList.contains("round"),n=e.parentElement.parentElement.parentElement.classList.contains("square"),i=e.parentElement.parentElement.parentElement.dataset.usertip;if((o||n||i||100==a||a>255||0==a)&&s){if(o){let a="";a=lang_from_json(`encoder_round${e.parentElement.parentElement.parentElement.className.match(/(.sw|.ccw|.cw)/g)[0]}`),e.dataset.tooltip=a+e.dataset.tooltip}if(n){let a="";a=lang_from_json(`encoder_square${e.parentElement.parentElement.parentElement.className.match(/(.sw|.upward|.dnward)/g)[0]}`),e.dataset.tooltip=a+e.dataset.tooltip}if(i&&(e.dataset.tooltip=i+e.dataset.tooltip),null==t)t=M.Tooltip.init(e)}else t&&t.destroy()}function S(e){var a;if(keycodes[e]&&!(e>255))return e<101?(a=keycodes[e].desc,e<2&&(a=keycodes[e].id)):a=keycodes[e].name,is_mac&&keycodes[e].name_mac&&(a=keycodes[e].name_mac),a}for(var L in $("#advanced-mode-toggle").click((function(){$("#advanced-mode-layer").css("display",$(this).prop("checked")?"block":"none")})),$("#keymap-layer-copy").click((function(){for(var e=0;e<8;e++)for(var a=0;a<16;a++)_[e][a]=keymaps[i][e][a];$("#copied-layer_1, #copied-layer_2").text(i)})),$("#keymap-layer-paste").click((function(){keymaps[i]=Array.from(_),h()})),$("#keymap-layer-clear").click((function(){$(this).hasClass("recovery")?($(this).removeClass("recovery").text("清空当前层设置"),keymaps[i]=Array.from(_)):($(this).addClass("recovery").text("恢复当前层设置"),_=Array.from(keymaps[i]),keymaps[i]=Array.from(transparent_map())),h()})),$("#keymap-layer-exchange").click((function(){var e,a=$("#copied-layer_1").text();e=keymaps[i],keymaps[i]=keymaps[a],keymaps[a]=e,h()})),$("#preset-keymap-list").on("click","li",(function(){var e=$("#keyboard-outline").find("[id^='kb-preset_keymap-"+this.value+"']"),a=url_decode_keymap(e.attr("value-keymap").replace(/YDKB/g,"+"));null!=a&&(D=a,console.log(D));var t=e.attr("value-layout");t&&U(l=unzip(t)),I(),h()})),$(".editor_dropdown").hide(),action_kinds){var O="LAUNCH_SHORTCUT"==action_kinds[L].id?action_kinds[L].link:"edit-keymap/"+action_kinds[L].link;$("#kind_dropdown").append(`<li value="${action_kinds[L].id}" class="tooltipped" data-tooltip="${action_kinds[L].desc}" data-position="right" data-helplink="${O}" lang="zh_sc"> <a lang="zh_sc"> ${action_kinds[L].name}`)}for(var P in $("#kind_dropdown").find('[value^="OPT_GROUP"]').addClass("disabled optgroup uicolor-text").removeClass("tooltipped"),$("#kind_dropdown").find('[value="UNKNOWN"]').addClass("hide"),keycodes)2!=P&&3!=P&&P<255&&($("#keycodes_dropdown").append(H(P,keycodes[P].desc,S(P))),P<176&&$("#keycodes4tap_dropdown").append(H(P,keycodes[P].desc,S(P))));for(var R=0;R<8;R++)$("#layer_dropdown").append(H(R,"Layer "+R,"Layer "+R));for(R=0;R<24;R++){let e=R%8;R<8?$("#layer_tap_dropdown").append(H(R,`Layer ${e}`,`Layer ${e}`)):R<16?$("#layer_tap_dropdown").append(H(R,`Layer ${e}(S)`,`Layer ${e}(S)`)):R>16&&$("#layer_tap_dropdown").append(H(R,`Layer ${e}(P)`,`Layer ${e}(P)`))}for(var P in on_codes)$("#layer_on_dropdown").append(H(P,on_codes[P].desc,on_codes[P].name));for(R=0;R<100;R++){var N=("0"+R).slice(-2);$("#launch_shortcut_dropdown").append(H("0x47"+N,"Launch Shortcut "+N,"Shortcut "+N))}var Y=function(e){var a=new Action(e),t=(new Action(255&e),$("#kind_dropdown").find("[value="+a.id+"]").text());$("#kind_dropdown-btn").html(t).attr({value:a.id}),$("#fn-set").find("ul li").removeClass("uicolor").removeAttr("style"),$("#kind_dropdown").find("[value="+a.id+"]").addClass("uicolor"),$("#kind_dropdown").trigger("change");var s=S(e);e>255&&e<53248&&(s=S(255&e)),$("#keycodes_dropdown-btn").html(s).attr({value:a.key_code}),$("#keycodes_dropdown").find("[value="+a.key_code+"]").addClass("uicolor"),(255&e)<176&&($("#keycodes4tap_dropdown-btn").html(s).attr({value:a.key_code}),$("#keycodes4tap_dropdown").find("[value="+a.key_code+"]").addClass("uicolor"));var o=a.id&&a.id.match(/(.*?)MOD(.*?)/)?mods_codes[e>>8&31].name:"";$("#key_mods_dropdown-btn").html(o).attr({value:a.key_mods});for(var n=0;n<5;n++){var i=1<<n;$("#key_mods_dropdown").find("[value="+i+"]").prop("checked",a.key_mods&i)}$("#key_mods_dropdown").find("[value=0]").prop("checked",a.key_mods<16),$("#key_mods_dropdown").find("[value=0x10]").prop("checked",a.key_mods>16);var d="",c=0;$("#key_mods_dropdown input:checked").each((function(e,a){c|=$(this).val(),$(this).val()>0&&$(this).val()<16&&(d+=(c<16?"":"r")+$(this).parent().text()+"+")})),d.length>2&&$("#key_mods_dropdown-btn").html(d.slice(0,-1));var r=a.layer_tap_val<16?a.layer_tap_val:0;if("LAYER_TOGGLE"==a.id||"DEFAULT_LAYER_SET"==a.id){for(var l=15&e;l>>1;l>>=1)r++;r+=4*((224&e)>>5)}"LAYER_TOGGLE"==a.id?r-=10:"DEFAULT_LAYER_SET"==a.id&&(r-=12),$("#layer_dropdown-btn").html("Layer "+r).attr({value:r}),$("#layer_dropdown").find("[value="+r+"]").addClass("uicolor"),r<8?$("#layer_tap_dropdown-btn").html("Layer "+r).attr({value:r}):$("#layer_tap_dropdown-btn").html("Layer "+(r-8)+"(S)").attr({value:r}),$("#layer_tap_dropdown").find("[value="+r+"]").addClass("uicolor"),$("#layer_mods_dropdown-btn").html(o).attr({value:15&a.layer_tap_code});for(n=0;n<5;n++){i=1<<n;$("#layer_mods_dropdown").find("[value="+i+"]").prop("checked",15&a.layer_tap_code&i)}d="",c=0,$("#layer_mods_dropdown input:checked").each((function(e,a){$(this).val()>0&&$(this).val()<16&&(d+=$(this).parent().text()+"+")})),d.length>2&&$("#layer_mods_dropdown-btn").html(d.slice(0,-1)),$("#layer_on_dropdown-btn").html("Layer "+a.layer_bitop_op).attr({value:a.layer_bitop_op}),$.cookie("uicolor")&&$("#fn-set").find("ul li.uicolor").css({"background-color":$.cookie("uicolor")})};$("[id$=dropdown-btn]").on("click",(function(){var e=this.id.replace("-btn","");$("[id$=dropdown]").hide(),$("#"+e).show()})),$("#fn-set").find("[id$=_dropdown]").on("click","li",(function(){var e=$(this).offsetParent().attr("id"),a=$(this).attr("value");$("#fn-set").find("#"+e+"-btn").text($(this).text()).attr({value:a}),$("#"+e).find("li").removeClass("uicolor").removeAttr("style"),$("#"+e).find("[value="+a+"]").addClass("uicolor"),$.cookie("uicolor")&&$("#fn-set #"+e).find("[value="+a+"]").css({"background-color":$.cookie("uicolor")}),$("#kind_dropdown").trigger("change");var t=$("#"+e+"-btn");t&&-1==e.indexOf("_mods_")&&M.Dropdown.getInstance(t[0]).close();if("key_mods_dropdown"==e||"layer_mods_dropdown"==e){var s=0,o="";$(this).find("input[type=checkbox]").prop("checked",!$(this).find("input[type=checkbox]").prop("checked")),$("#"+e+" input:checked").each((function(e,a){s|=$(this).val(),$(this).val()>0&&$(this).val()<16&&(o+=(s<16?"":"r")+$(this).parent().text()+"+")})),$("#fn-set").find("#"+e+"-btn").text(o.slice(0,-1)).attr({value:s})}})),$("#fn-set").find("button.action-apply").click((function(a){if(e){var t=action_editor_get_code();ani_fly_button(t,getElementAbsPos($(this)[0])),C(t)}}));var F=[],x=[],D=[];function B(e){return fetch(e).then(checkResponse).then((function(e){var a=e.headers.get("Last-Modified"),t=format_date(new Date(a));return $("#latest_firmware_date, #latest_firmware_date_short").hide(),$("#latest_firmware_date").text(t.long),e.text()})).then((function(e){var a,t=hex_split_firmware(e,KEYMAP_START_ADDRESS,KEYMAP_SIZE);(F=t.before,x=t.after,!p&&$("#kb-preset_keymap-0").length>0)?(console.log("load keymap0"),null!=(a=url_decode_keymap($("#kb-preset_keymap-0").attr("value-keymap").replace(/YDKB/g,"+")))&&(D=a)):(D=p?keymaps:t.keymaps,I());console4jslang&&!p&&$("#yang_keymap").length>0&&(null!=(a=url_decode_keymap($("#yang_keymap").attr("value-keymap").replace(/YDKB/g,"+")))&&(D=a),$("#yang_keymap").remove());if(0!=t.date){var s={};s.short=shorten_date(t.date[0])+shorten_date(t.date[1])+shorten_date(t.date[2]),s.long="20"+t.date[0]+"-"+t.date[1]+"-"+t.date[2]+$("#latest_firmware_date").text().slice(10),$("#latest_firmware_date").text(s.long),$("#latest_firmware_date_short").text(s.short),console.log(t.date)}else $("#latest_firmware_date").text("2020"),$("#latest_firmware_date_short").text("2020");return $("#latest_firmware_date, #latest_firmware_date_short").show(),e})).catch((function(e){console.log("request failed",e)}))}$("#firmwareFile").change((function(e){var a=e.target.files[0];if(a){var t=new FileReader;t.onloadend=function(e){var t,s=a.name.toLowerCase();if(s.match(/.hex/g)){var o=convert_hex2bin(this.result,0,0);console.log("size:"+o.length),t=31744==o.length?hex_split_firmware(this.result,29696,2048):hex_split_firmware(this.result,KEYMAP_START_ADDRESS,KEYMAP_SIZE)}else if(s.match(/.uf2/g)){var i=uf2_to_bin(this.result);t=bin_split_firmware(i.binstr,KEYMAP_START_ADDRESS,KEYMAP_SIZE,i.bin_start_addr)}else s.match(/.bin/g)&&(t="hw75"==n?bin_split_firmware(this.result,KEYMAP_START_ADDRESS,KEYMAP_SIZE,16384):bin_split_firmware(this.result,KEYMAP_START_ADDRESS,KEYMAP_SIZE));if(D=t.keymaps,console.log(D),"udock"==n||"unicore_f1"==n){var d=t.after;if(d.length>0&&205==d[0]){for(var c=d[1]|d[2]<<8,r="",_=0;_<c;_++)r+=String.fromCharCode(d[_+3]);U(l=unzip(r))}}$("#keymap-load").prop("disabled",!1),$("#keymap-load-div").show(),I(),h()},t.readAsBinaryString(a),$("#firmwareFile").val("")}else $("#keymap-load").prop("disabled",!0)})),$("#keymap-load").prop("disabled",!0),$("#keymap-load").click((function(e,a){I()}));var I=function(){for(keymaps=$.extend(!0,[],D);keymaps.length<KEYMAP_LAYERS;)keymaps.push(transparent_map());var e=""+parseInt(keymaps[1][0][0]<<16|keymaps[0][0][0]);if(console.log(parseInt(o)+1+" layouts:"+e),"1"==e.slice(0,1)&&e.length-2==o){var a=e.slice(1).match(/(\d)/g);0==layouts_save&&(layouts_save=e.slice(1));for(var t=0;t<o+1;t++){for(var s=0;s<$("div[id^='kblayouts-"+t+"']").length+1;s++)$("#kblayouts-"+t+s).hide(),$("#layouts-"+t+s).prop({checked:"false"}),$("#keyboard-outline").find(".akblayouts-"+t+s).hide();$("#kblayouts-"+t+a[t]).show(),$("#layouts-"+t+a[t]).prop({checked:"checked"}),$("#keyboard-outline").find(".akblayouts-"+t+a[t]).show()}}update_indicator(10),update_indicator_color(10)};function U(e){var a=$("#keyboard-outline")[0].offsetHeight;if($("#kbd-layout").empty(),$("#kbd-layout").append(e),$("#kbd-layout").find("[class^=mykeycap]").each((function(){var e=0,a=$(this).text().toLowerCase().match(/uc_k([0-9a-v])([0-9a-v])/i);a&&3==a.length?e=("0"+(8*parseInt(a[1])+parseInt(a[2])+8).toString(16)).slice(-2):e=keyName2tmkCode($(this).text().toUpperCase()).toLowerCase();$(this).empty(),$(this).append('<div class="plate"></div><div class="border"><div class="top"><div class="key k{0}">'.format(e))})),$("#layouts-set").empty(),$("#layouts-set-div, #layouts-set-on2").hide(),$("#kblayouts-00").length>0){if($("#layouts-set-div, #layouts-set-on2").show(),$("#layouts-set-on").removeClass("scale-out"),$("#layouts-set").empty(),layouts_save)var t=layouts_save.match(/(\d)/g);o=0,$("div[id^='kblayouts-']").each((function(){var e=this.id.match(/kblayouts-(\d)(\d)/),a=e[1],s=e[2];o<a&&(o=a),0==s&&($("#layouts-set").append('<div class="rowstart">[ '+$(this).attr("value-desc")+" ]"),$("#layouts-set").append('<div id="layouts-'+a+'">'),t&&t[a]||(layouts_save+="0")),$("#layouts-"+a).append('<label><input type="radio" id="layouts-'+a+s+'" class="layouts-'+a+' with-gap" name="layouts-'+a+'"/><span for="layouts-'+a+s+'">'+$(this).attr("value-name")),t&&t[a]&&($("#kblayouts-"+a+"0").hide(),$("#kblayouts-"+a+t[a]).show()),"block"==$(this).css("display")&&$("#layouts-"+a+s).prop({checked:"checked"})}))}h();var s=$("#keyboard-outline")[0].offsetHeight,n=$("#keyboard-outline").find(".keyboard-mask");n.css("height",parseInt(n.css("height"))+s-a+"px")}$("#keyboard-outline").on("change","#layoutFile",(function(e,a){var t=e.target.files[0];if(t){var s=new FileReader;s.onloadend=function(e){if(t.name.match(/.html/g)){if(!this.result.match(/(mykeycap.*)/))return void alert(lang_from_json("not a layout file"));U(l=this.result)}},s.readAsBinaryString(t),$("#layoutFile").val("")}})),$("#hex-download").prop("disabled",!0),$("#hex-download, #bin-download, #uf2-download").click((function(e,a){$("#firmwareFile")[0].files[0]&&$("#firmwareFile")[0].files[0].name.match(/\.hex/)&&console.log("hex file");var t,s=".hex";if("uf2-download"==this.id){var o=[].concat(F).concat(hex_keymaps(KEYMAP_START_ADDRESS)),i=convert_hex2bin(o,16384,KEYMAP_START_ADDRESS+KEYMAP_SIZE);console.log(i);var d=1591873650,c=$("#kbd-firmware");c.attr("value-family-id")&&(d=parseInt(c.attr("value-family-id"),16)),console.log("0x"+d.toString(16));var r=bin_to_uf2(i,134234112,d);if("unicore_f1"==n&&l.length>0){var _=zip(l);console.log("layout: "+_);var m=new Uint8Array(3+_.length);console.log("save layout file "+l.length+" to "+_.length),m[0]=205,m[1]=255&_.length,m[2]=_.length>>8;for(var u=0;u<_.length;u++)m[3+u]=_[u].charCodeAt();layout_file_content=bin_to_uf2(m,134283264,d),r=new Uint8Array([...r,...layout_file_content])}t=new Blob([r],{type:"application/octet-stream"}),console.log(r),s=".uf2"}else if("bin-download"==this.id){o=[].concat(F).concat(hex_keymaps(KEYMAP_START_ADDRESS));var p=0;if("1800mini"!=n&&"master98"!=n&&"sairo64"!=n&&"x8086k"!=n&&"u2u_pro"!=n&&"udock"!=n||(p=57344),-1!=n.indexOf("hw75"))i=convert_hex2bin(o,16384,KEYMAP_START_ADDRESS+KEYMAP_SIZE+p);else i=convert_hex2bin(o,0,KEYMAP_START_ADDRESS+KEYMAP_SIZE+p);if("udock"==n&&l.length>0){_=zip(l);console.log(l.length+" to "+_.length),i[65536]=205,i[65537]=255&_.length,i[65538]=_.length>>8;for(u=0;u<_.length;u++)i[65539+u]=_[u].charCodeAt()}var f=CONFIG.kbd[n].checksum;if(f){var y=0;for(R=0;R<i.length;R++){var k=i[R];word=1&R?k<<8:k,y+=word}var h=i[f.addr]|i[f.addr+1]<<8;y-=h,h=f.value-y&65535,e.shiftKey&e.altKey&&(h=0),i[f.addr]=255&h,i[f.addr+1]=h>>8}if(t=new Blob([i],{type:"application/octet-stream"}),s=".BIN",i[0]==i[1]&&i[1]==i[2])return void alert(lang_from_json("download file wrong"))}else{var b=[].concat(F).concat(hex_keymaps(KEYMAP_START_ADDRESS)).concat(x).join("\r\n").concat("\r\n");t=new Blob([b],{type:"application/octet-stream"})}var g=$("#kbd-firmware").attr("value-filename");null==g&&(g=n,"bin-download"==this.id&&(g=g.toUpperCase())),saveAs(t,g+s)})),$("#share-dialog-btn").click((function(){update_share_url_panel()})),$("#keymap-share, #shorten-url").click((function(e,a){var t=zip(JSON.stringify(keymaps)),s=document.location.origin+document.location.pathname+"?"+(n+($("#kblayouts-00").length>0?"-"+layouts_save:""))+"#"+t;"shorten-url"==this.id?(navigator.clipboard.writeText(t),$("#share-url").val(t),M.textareaAutoResize($("#share-url")),$("#share-dialog").removeClass("url-long"),M.toast({html:"复制成功",classes:"rounded",displayLength:"1000"})):($("#share-url").val(s),M.textareaAutoResize($("#share-url")),$("#share-dialog").addClass("url-long")),update_share_url_panel()})),$("#output-c").click((function(e,a){$("#keymap-c").text().length>0?(navigator.clipboard.writeText($("#keymap-c").text()),$("#keymap-c").text("")):(keymaps[7][0][0]=0,$("#keymap-c").text(source_output(keymaps))),M.textareaAutoResize($("#keymap-c"))})),$(window).bind("beforeunload",(function(){return"CAUTION: You will lost your change."})),$("#show-tabs-kbdinfo").click((function(e,a){$("#key-set-tabs").tabs("select","tabs-kbdinfo")}));var K=$.Deferred().resolve();CONFIG.kbd[variant]&&CONFIG.kbd[variant].firmware_url&&($("#firmware-dropdown").val(variant),K=B(CONFIG.kbd[variant].firmware_url).then((function(e){if(!document.location.hash)for(keymaps=$.extend(!0,[],D);keymaps.length<KEYMAP_LAYERS;)keymaps.push(transparent_map());$("#hex-download").prop("disabled",!1),$("#keymap-load").prop("disabled",!1)})));var G=function(e){var a=CONFIG.kbd[n].size;if(a){var t,s,i,d,c;a.M?t=s=i=d=a.M:(t=a.MU?a.MU:-12,s=a.MR?a.MR:-12,i=a.MD?a.MD:-12,d=a.ML?a.ML:-12),c=a.BR?a.BR:-d-6;var r=54*a.X-d-s,l=54*a.Y-t-i}var _=$(".keyboard-mask")[0],m=_?_.offsetHeight:0;fetch(e).then(checkResponse).then(parseTEXT).then((function(e){if($("#keyboard-outline").html(e),a&&($("#keyboard-outline").prepend(_),a.X&&a.Y)){var u=`height: ${m-30}px; width: 54px; padding: ${-t-8}px 0 0 ${640-27*a.X}px;`;$("#mykbd").attr("style",u);var f=`<div class="{0}" style="margin: ${t}px ${s}px ${i}px ${d}px; height: ${l}px; width: ${r}px; border-radius: ${c}px">`;$("#mycase").prepend(f.format("kbdbg-mask")).prepend(f.format("kbdbg-border"))}var y=$("#kbd-firmware");if(y.attr("value-keymapaddr")?KEYMAP_START_ADDRESS=parseInt(y.attr("value-keymapaddr"),16):KEYMAP_START_ADDRESS=26624,console.log("KEYMAP_ADDR: 0x"+KEYMAP_START_ADDRESS.toString(16)),B(CONFIG.kbd[n].firmware_url).then((function(e){p||(I(),$("#advanced-mode-toggle").prop("checked")&&(p=1)),$("#layer_set").tabs("select","layer_0"),$("#keyboard-outline").find(".keyboard-mask").addClass("hidef"),setTimeout((function(){$("#loading").hide()}),600),setTimeout((function(){first_visit()}),800)})),$("#tool-download").parent().show(),$("#hex-download").parent().show(),$("#bin-download").parent().hide(),$("#uf2-download").parent().hide(),y.attr("value-format")){$("#tool-download").parent().hide();var k=y.attr("value-format");console.log("Firmware format: "+k),k.match(/bin/g)&&($("#bin-download").parent().show(),console4jslang||$("#hex-download").parent().hide()),k.match(/uf2/g)&&($("#uf2-download").parent().show(),console4jslang||$("#hex-download").parent().hide()),k.match(/hex/g)&&($("#hex-download").parent().show(),$("#tool-download").parent().show())}$("#keyboard-outline").find("[class^=mykeycap]").each((function(){var e=0,a=$(this).text().toLowerCase().match(/uc_k([0-9a-v])([0-9a-v])/i);a&&3==a.length?e=("0"+(8*parseInt(a[1])+parseInt(a[2])+8).toString(16)).slice(-2):e=keyName2tmkCode($(this).text().toUpperCase()).toLowerCase();$(this).empty(),$(this).append(`<div class="plate"></div><div class="border"><div class="top"><div class="key k${e}">`);var t=$(this).attr("class").match(/.*(led(\d)).*/);if(t&&($(this).removeClass(t[1]).find(".border").prepend(`<div class="kbd-led ${t[1]}">`),$(this).hasClass("suden")&&$(this).removeClass("suden").find(".kbd-led").addClass("suden"),t[2]>7)){var s=$(this).attr("data-tooltip"),o=$(this).attr("led-color");o||(o="red"),$(this).removeAttr("data-tooltip led-color").find(".kbd-led").attr("data-tooltip",s).css("background-color",o)}})),$("#keyboard-outline").find(".kbd-led").each((function(){$(this).attr("class").match(/.*(led(\d)).*/)&&$(this).addClass("tooltipped").attr("data-position","left")}));var h,b=$("#kbd-info").attr("value-type");if(b){var g=$("#kbd-firmware").attr("value-filename");if(null==g){g=CONFIG.kbd[n].name;var v=$("#kbd-firmware").attr("value-filename");v&&(g=v),"lufa_msd_usb"==b&&(b="lufa_msd_ble"),"lufa_msd_ble"==b&&(g=g.toUpperCase())}var A=$("#kbd-firmware").attr("value-diskname");null==A&&(A=g),function(e,a,t){fetch("config/templates_bootloader.html").then(checkResponse).then(parseTEXT).then((function(s){var o=$(s),n=$(o).find("#"+t).html();z(n=n.replace(/BIN_NAME/g,e).replace(/DISK_NAME/g,a)),onLangChange(NOW_LANG)}))}(g,A,b)}else h=$("#kbd-info").html(),$("#kbd-info").remove(),$("#kbdinfo_detail").empty(),h?z(h):$("#kbdinfo_detail").append("暂无其他说明");$("#purchase-link").empty(),$("#purchase-link").append(`<li class="waves-effect waves-light"><a href="#!">尊重劳动成果，远离山寨。右侧为 ${CONFIG.kbd[n].name} 正规购买渠道和介绍。`);var E=$("[id^='kbd-purchase_link_']");if($(".fixed-action-btn.toolbar").find(".scale-transition").toggleClass("scale-out",0==E.length),E.each((function(e){$("#purchase-link").append(`<li class="waves-effect waves-light"><a href=${$(this).attr("value")} target="_blank">${$(this).text()}`),$(this).remove()})),$("#macrofn").empty(),$("#macrofn").hide(),$("#macrofn").html($("#kbd-macrofn").html().replace(/\(R\)/g,"<SUB> (R)</SUB>").replace(/\(L\)/g,"<SUB> (L)</SUB>")),$("#kbd-macrofn").remove(),fetch("/config/templates_led_fn.html").then(checkResponse).then(parseTEXT).then((function(e){var a=$(e),t=["#backlight_control_keys","#ble51_control_keys","#ble51_control_keys_v2","#ble51_control_keys_v3","#rgb_control_keys"];for(R in $("#rgblight-help, #backlight-help").hide(),t)$(t[R]).each((function(){var e=$(a).find(t[R]).html();$(this).html(e),"#backlight_control_keys"==t[R]&&$("#backlight-help").show(),"#rgb_control_keys"==t[R]&&$("#rgblight-help").show()}))})).then((function(e){$("#macrofn").html($("#macrofn").html().replaceAll('id="code-','kc="')),$("#macrofn").find("[kc]").addClass("key-set"),$("#macrofn").show(),onLangChange(NOW_LANG)})),$("#kblayouts-00").length>0){if($("#layouts-set-div, #layouts-set-on2").show(),$("#layouts-set-on").removeClass("scale-out"),$("#layouts-set").empty(),layouts_save)var w=layouts_save.match(/(\d)/g);o=0,$("div[id^='kblayouts-']").each((function(){var e=this.id.match(/kblayouts-(\d)(\d)/),a=e[1],t=e[2];o<a&&(o=a),0==t&&($("#layouts-set").append('<div class="rowstart">[ '+$(this).attr("value-desc")+" ]"),$("#layouts-set").append('<div id="layouts-'+a+'">'),w&&w[a]||(layouts_save+="0")),$("#layouts-"+a).append('<label><input type="radio" id="layouts-'+a+t+'" class="layouts-'+a+' with-gap" name="layouts-'+a+'"/><span for="layouts-'+a+t+'">'+$(this).attr("value-name")),w&&w[a]&&($("#kblayouts-"+a+"0").hide(),$("#kblayouts-"+a+w[a]).show()),"block"==$(this).css("display")&&$("#layouts-"+a+t).prop({checked:"checked"})}))}if($("#ledmap-tab,[id^='indicator_dropdown-'], [id^='indicator-color-']").each((function(){$(this).hide()})),$("#kb_ledmap-0").length>0&&($("#ledmap-tab").show(),$("[id^='kb_ledmap-']").each((function(){var e=this.id.replace("kb_ledmap-","");$("#indicator_dropdown-name_"+e).show().text($(this).text()).attr({"data-tooltip":$(this).attr("title")}),$("#indicator_dropdown-btn_"+e).show(),$(this).hasClass("rgb_color")&&$("#indicator-color-btn_"+e).show(),p||update_indicator(e,this.value)}))),$("#preset-keymap-group").hide(),$("#preset-keymap-list").empty(),$("#kb-preset_keymap").length>0&&($("#preset-keymap-group").show(),$("[id^='kb-preset_keymap-']").each((function(){var e=this.id.replace("kb-preset_keymap-","");$("#preset-keymap-list").append(H(e,this.title,'<i class="material-icons mr5">cloud_download</i>'+$(this).text()))}))),$("#kb-changelog-url").length>0){var C=$("#kb-changelog-url").attr("href"),T=C.match(/.*?changelog:(.*)/),S="help/#/changelog/"+(T&&T.length>1?T[1]:C);$("#latest_firmware_changelog").attr("href",S).attr("target","_blank").show()}else $("#latest_firmware_changelog").removeAttr("href target");onLangChange(NOW_LANG)})).catch((function(e){console.log("request failed",e)}))};function z(e){e=e.replace("https://ydkb.io/","/"),$("#kbdinfo_detail").html(e),init_space($("#kbdinfo_detail")),console.log($("#kbd-info").attr("value-type")),"lufa_msd_usb"==$("#kbd-info").attr("value-type")&&$("#kbdinfo_detail").find(".for-ble").remove(),$("#kbdinfo_detail").html($("#kbdinfo_detail").html().replaceAll("<hanla></hanla>"," "))}function H(e,a,t){return`<li value="${e}" title="${a}" lang="zh_sc"> <a lang="zh_sc">${t}`}function W(e){$.cookie&&(null==e?e=$.cookie("uicolor"):$.cookie("uicolor",e,{expires:365,path:"/"})),e&&(document.documentElement.style.setProperty("--uicolor",e),$("html").toggleClass("dark-mode","rgb(36, 36, 36)"==e.toString()))}function X(e){$.cookie?null==e?e=$.cookie("ck_case_style"):$.cookie("ck_case_style",e,{expires:365,path:"/"}):null==e&&t&&(e=t),e&&(document.documentElement.style.setProperty("--mycase-background-image",e),t=e)}function j(e){if($.cookie?null==e?(e=$.cookie("ck_keycap_style"),c=e||"gmk"):$.cookie("ck_keycap_style",e,{expires:365,path:"/"}):null==e&&t&&(e=c),e&&null!=e){$("#keycap_style_gmk").remove(),$("#keycap_style_flat").remove();var a='<link id="keycap_style_flat" href="flat.css" rel="stylesheet">',s='<link id="keycap_style_gmk" href="gmk.css" rel="stylesheet">';"gmk"==e?($(a).appendTo("head"),$(s).appendTo("head")):"flat"==e?($(s).appendTo("head"),$(a).appendTo("head")):"dsa"==e&&($('<link id="keycap_style_gmk" class="nowdsa" href="gmk.css" rel="stylesheet">').prependTo("head"),$(a).prependTo("head")),h()}}function J(e){$("#keyboard-outline").find(".key:visible").toggleClass("fade-in-down",e).toggleClass("fade-in-up",!e),setTimeout((function(){$("#keyboard-outline").find(".key").removeClass("fade-in-down fade-in-up")}),400),h();var a=e?"none":"block",t=e?"block":"none";for(var s in $("#tabs-main").find(".name_win").each((function(){$(this).css("display",a)})),$("#tabs-main").find(".name_mac").each((function(){$(this).css("display",t)})),$("#mykeycap_system_change button").removeClass("using"),e?$("#system_mac").addClass("using"):$("#system_win").addClass("using"),keycodes)keycodes[s].desc_mac&&$("#keycodes_dropdown, #keycodes4tap_dropdown").find("[value="+s+"]").attr("title",e?keycodes[s].desc_mac:keycodes[s].desc).find("a").text(S(s));$("#key_mods_dropdown, #layer_mods_dropdown").find("label").each((function(){var a=$(this).html();e?$(this).html(a.replace("Alt","Option").replace("Win","Cmd")):$(this).html(a.replace("Option","Alt").replace("Cmd","Win"))})),$(".key-set").each((function(e){var a=display_label(parseInt($(this).attr("kc")),0);$(this).attr({title:a.desc}),$(this).attr("key")&&$(this).html(a.name)}))}$.when(K).then((function(){variant?n=variant:$.cookie&&$.cookie("ck_select_kbd")&&(n=$.cookie("ck_select_kbd")),y(n)})),$("#keyboard-outline").on("mousedown","[class^='mykeycap']",(function(a){if(2!=a.button&&!$("#kbdinfo_tab").hasClass("active")){var t=$(":hover");if(!t[t.length-1].className.match("kbd-led")&&"k80"!=(e=$(this).find(".key")[0].classList[1])){if($(this).hasClass("key-editing"))$(this).removeClass("key-editing"),$("main").removeClass("editing-key"),e=null;else{$("#keyboard-outline").find(".key-editing").removeClass("key-editing"),$("[id$=dropdown]").hide(),$(this).addClass("key-editing"),$("main").addClass("editing-key"),$("#fly-button").removeClass("fly");var s=w(),o=keymaps[i][s.row][s.col];Y(o)}1==a.button&&(a.preventDefault(),a.shiftKey?C(0):C(1)),$(this).blur()}}})),$("#import-user-keycap-colors").click((function(e,a){console.log($("#user-keycap-colors").val());var t=$("#user-keycap-colors").val().split(",");t instanceof Array&&6==t.length&&update_keycap_color(t)}))})),String.prototype.replaceAll=function(e,a){return this.replace(new RegExp(e,"gm"),a)};var action_kinds={KEY:{id:"KEY",name:"常规按键",desc:"常规按键，右击查看帮助",link:"normal-key"},MODS_KEY:{id:"MODS_KEY",name:"修饰键（组合键）",desc:"修饰键，指ctrl shift alt(option) win(command)这些，右击查看帮助",link:"mods-key"},LAYER_MOMENTARY:{id:"LAYER_MOMENTARY",name:"瞬时开启层",desc:"按下按键时瞬时开启层，放开按键时层会关闭，右击查看帮助",link:"l-layer"},LAYER_TOGGLE:{id:"LAYER_TOGGLE",name:"层开关",desc:"切换层开关，右击查看帮助",link:"t-layer"},LAYER_MODS:{id:"LAYER_MODS",name:"修饰键 & 瞬时开启层",desc:"瞬时开启层的同时按下修饰键(目前仅支持左修饰键)，右击查看帮助",link:"layer-mods"},DEFAULT_LAYER_SET:{id:"DEFAULT_LAYER_SET",name:"设置默认层",desc:"设置一个层为默认层，右击查看帮助",link:"default-layer-set"},LAUNCH_SHORTCUT:{id:"LAUNCH_SHORTCUT",name:"启动快捷方式",desc:"启动一个快捷方式(仅支持windows)，右击查看帮助",link:"features/shortcut"},OPT_GROUP2:{id:"OPT_GROUP2",name:"Tap二合一功能按键 ▼",desc:"Tap二合一功能按键"},MODS_TAP_KEY:{id:"MODS_TAP_KEY",name:"按键 | 修饰键",desc:"单击时是按键，长按及和其他键组合时是修饰键，右击查看帮助",link:"mods-tap-key"},LAYER_TAP_KEY:{id:"LAYER_TAP_KEY",name:"按键 | 瞬时开启层",desc:"单击是按键，长按及和其他键组合时是瞬时开启层，右击查看帮助",link:"layer-tap-key"},LAYER_TAP_TOGGLE:{id:"LAYER_TAP_TOGGLE",name:"层开关 | 瞬时开启层",desc:"瞬时开启层，如果连续点击数次时开关层，右击查看帮助",link:"lt-layer"},UNKNOWN:{id:"UNKNOWN",name:"其他",desc:"用于显示特殊功能，或该键盘不支持的功能",link:""}};Object.freeze(action_kinds);var keycodes=[];keycodes[0]={id:"NO  ",name:'<i class="fa fa-ban fs22"></i>',desc:"当前层禁用此按键。也可用<kt>shift</kt>+<kt>鼠标中键</kt>点击设置"},keycodes[1]={id:"TRNS",name:"▽",desc:"当前层此按键穿透到更低层。可用<kt>鼠标中键</kt>点击按键设置"},keycodes[2]={id:"POST_FAIL",name:"POST_FAIL",desc:"POST_FAIL"},keycodes[3]={id:"UNDEFINED",name:"UNDEFINED",desc:"UNDEFINED"},keycodes[4]={id:"A",name:"A",desc:"A"},keycodes[5]={id:"B",name:"B",desc:"B"},keycodes[6]={id:"C",name:"C",desc:"C"},keycodes[7]={id:"D",name:"D",desc:"D"},keycodes[8]={id:"E",name:"E",desc:"E"},keycodes[9]={id:"F",name:"F",desc:"F"},keycodes[10]={id:"G",name:"G",desc:"G"},keycodes[11]={id:"H",name:"H",desc:"H"},keycodes[12]={id:"I",name:"I",desc:"I"},keycodes[13]={id:"J",name:"J",desc:"J"},keycodes[14]={id:"K",name:"K",desc:"K"},keycodes[15]={id:"L",name:"L",desc:"L"},keycodes[16]={id:"M",name:"M",desc:"M"},keycodes[17]={id:"N",name:"N",desc:"N"},keycodes[18]={id:"O",name:"O",desc:"O"},keycodes[19]={id:"P",name:"P",desc:"P"},keycodes[20]={id:"Q",name:"Q",desc:"Q"},keycodes[21]={id:"R",name:"R",desc:"R"},keycodes[22]={id:"S",name:"S",desc:"S"},keycodes[23]={id:"T",name:"T",desc:"T"},keycodes[24]={id:"U",name:"U",desc:"U"},keycodes[25]={id:"V",name:"V",desc:"V"},keycodes[26]={id:"W",name:"W",desc:"W"},keycodes[27]={id:"X",name:"X",desc:"X"},keycodes[28]={id:"Y",name:"Y",desc:"Y"},keycodes[29]={id:"Z",name:"Z",desc:"Z"},keycodes[30]={id:"1",name:"!<br>1",desc:"1 !"},keycodes[31]={id:"2",name:"@<br>2",desc:"2 @"},keycodes[32]={id:"3",name:"#<br>3",desc:"3 #"},keycodes[33]={id:"4",name:"$<br>4",desc:"4 $"},keycodes[34]={id:"5",name:"%<br>5",desc:"5 %"},keycodes[35]={id:"6",name:"^<br>6",desc:"6 ^"},keycodes[36]={id:"7",name:"&<br>7",desc:"7 &"},keycodes[37]={id:"8",name:"*<br>8",desc:"8 *"},keycodes[38]={id:"9",name:"(<br>9",desc:"9 ("},keycodes[39]={id:"0",name:")<br>0",desc:"0 )"},keycodes[40]={id:"ENT",name:"Enter",desc:"Enter",name_mac:"Return",desc_mac:"Return"},keycodes[41]={id:"ESC",name:"Esc",desc:"Esc"},keycodes[42]={id:"BSPC",name:"BS",desc:"Backspace",name_mac:"Delete",desc_mac:"Delete"},keycodes[43]={id:"TAB",name:"Tab",desc:"Tab"},keycodes[44]={id:"SPC",name:"Space",desc:"Space"},keycodes[45]={id:"MINS",name:"_<br>-",desc:"- _"},keycodes[46]={id:"EQL",name:"+<br>=",desc:"= +"},keycodes[47]={id:"LBRC",name:"{<br>[",desc:"[ {"},keycodes[48]={id:"RBRC",name:"}<br>]",desc:"] }"},keycodes[49]={id:"BSLS",name:"|<br>\\",desc:"\\ |"},keycodes[50]={id:"NUHS",name:"~<br>#",desc:"ISO ~#"},keycodes[51]={id:"SCLN",name:":<br>;",desc:"; :"},keycodes[52]={id:"QUOT",name:"\"<br>'",desc:"' \""},keycodes[53]={id:"GRV ",name:"~<br>`",desc:"` ~"},keycodes[54]={id:"COMM",name:"<<br>,",desc:", <"},keycodes[55]={id:"DOT ",name:"><br>.",desc:". >"},keycodes[56]={id:"SLSH",name:"?<br>/",desc:"/ ?"},keycodes[57]={id:"CAPS",name:"Caps Lock",desc:"CapsLock"},keycodes[58]={id:"F1  ",name:"F1",desc:"F1"},keycodes[59]={id:"F2  ",name:"F2",desc:"F2"},keycodes[60]={id:"F3  ",name:"F3",desc:"F3"},keycodes[61]={id:"F4  ",name:"F4",desc:"F4"},keycodes[62]={id:"F5  ",name:"F5",desc:"F5"},keycodes[63]={id:"F6  ",name:"F6",desc:"F6"},keycodes[64]={id:"F7  ",name:"F7",desc:"F7"},keycodes[65]={id:"F8  ",name:"F8",desc:"F8"},keycodes[66]={id:"F9  ",name:"F9",desc:"F9"},keycodes[67]={id:"F10 ",name:"F10",desc:"F10"},keycodes[68]={id:"F11 ",name:"F11",desc:"F11"},keycodes[69]={id:"F12 ",name:"F12",desc:"F12"},keycodes[70]={id:"PSCR",name:"Print<br>Scrn",desc:"Print Screen",name_mac:"F13",desc_mac:"F13(mac)"},keycodes[71]={id:"SLCK",name:"Scrll<br>Lock",desc:"Scroll Lock",name_mac:"F14",desc_mac:"F14(mac)"},keycodes[72]={id:"PAUS",name:"Pause",desc:"Pause Break",name_mac:"F15",desc_mac:"F15(mac)"},keycodes[73]={id:"INS ",name:"Ins",desc:"Insert"},keycodes[74]={id:"HOME",name:"Home",desc:"Home"},keycodes[75]={id:"PGUP",name:"Page<br>Up",desc:"Page Up"},keycodes[76]={id:"DEL ",name:"Del",desc:"Del"},keycodes[77]={id:"END ",name:"End",desc:"End"},keycodes[78]={id:"PGDN",name:"Page<br>Dn",desc:"Page Down"},keycodes[79]={id:"RGHT",name:"→",name_dsa:'<i class="fa fa-arrow-right"/>',desc:"Right"},keycodes[80]={id:"LEFT",name:"←",name_dsa:'<i class="fa fa-arrow-left"/>',desc:"Left"},keycodes[81]={id:"DOWN",name:"↓",name_dsa:'<i class="fa fa-arrow-down"/>',desc:"Down"},keycodes[82]={id:"UP  ",name:"↑",name_dsa:'<i class="fa fa-arrow-up"/>',desc:"Up"},keycodes[83]={id:"NLCK",name:"Num<br>Lock",desc:"Num Lock",name_mac:"Clear",desc_mac:"Clear"},keycodes[84]={id:"PSLS",name:"/",name_dsa:"÷",desc:"Keypad /"},keycodes[85]={id:"PAST",name:"*",name_dsa:"×",desc:"Keypad *"},keycodes[86]={id:"PMNS",name:"-",desc:"Keypad -"},keycodes[87]={id:"PPLS",name:"+",desc:"Keypad +"},keycodes[88]={id:"PENT",name:"P↩",desc:"Keypad Enter"},keycodes[89]={id:"P1  ",name:'1<br><span class="fs10">End</span>',name_dsa:"1",desc:"Keypad 1"},keycodes[90]={id:"P2  ",name:"2<br>↓",name_dsa:"2",desc:"Keypad 2"},keycodes[91]={id:"P3  ",name:'3<br><span class="fs10">PgDn</span>',name_dsa:"3",desc:"Keypad 3"},keycodes[92]={id:"P4  ",name:"4<br>←",name_dsa:"4",desc:"Keypad 4"},keycodes[93]={id:"P5  ",name:"5",desc:"Keypad 5"},keycodes[94]={id:"P6  ",name:"6<br>→",name_dsa:"6",desc:"Keypad 6"},keycodes[95]={id:"P7  ",name:'7<br><span class="fs10">Home</span>',name_dsa:"7",desc:"Keypad 7"},keycodes[96]={id:"P8  ",name:"8<br>↑",name_dsa:"8",desc:"Keypad 8"},keycodes[97]={id:"P9  ",name:'9<br><span class="fs10">PgUp</span>',name_dsa:"9",desc:"Keypad 9"},keycodes[98]={id:"P0  ",name:'0<br><span class="fs10">Ins</span>',name_dsa:"0",desc:"Keypad 0"},keycodes[99]={id:"PDOT",name:'.<br><span class="fs10">Del</span>',name_dsa:".",desc:"Keypad ."},keycodes[100]={id:"NUBS",name:"|<sub>ISO</sub><br>\\",desc:"|\\ for ISO layout"},keycodes[101]={id:"APP ",name:"Menu",desc:"Menu on Win"},keycodes[102]={id:"POWER",name:"Power",desc:"Power(work on Mac)"},keycodes[103]={id:"PEQL",name:"=",desc:"Keymapd Equal(Not work on Win)"},keycodes[104]={id:"F13 ",name:"F13",desc:"F13"},keycodes[105]={id:"F14 ",name:"F14",desc:"F14"},keycodes[106]={id:"F15 ",name:"F15",desc:"F15"},keycodes[107]={id:"F16 ",name:"F16",desc:"F16"},keycodes[108]={id:"F17 ",name:"F17",desc:"F17"},keycodes[109]={id:"F18 ",name:"F18",desc:"F18"},keycodes[110]={id:"F19 ",name:"F19",desc:"F19"},keycodes[111]={id:"F20 ",name:"F20",desc:"F20"},keycodes[112]={id:"F21 ",name:"F21",desc:"F21"},keycodes[113]={id:"F22 ",name:"F22",desc:"F22"},keycodes[114]={id:"F23 ",name:"F23",desc:"F23"},keycodes[115]={id:"F24 ",name:"F24",desc:"F24"},keycodes[130]={id:"LCAP",name:"Locking Caps Lock",desc:"Locking Caps Lock"},keycodes[131]={id:"LNUM",name:"Locking Num Lock",desc:"Locking Num Lock"},keycodes[132]={id:"LSCR",name:"Locking Scroll Lock",desc:"Locking Scroll Lock"},keycodes[135]={id:"INT1",name:"JIS ろ",desc:"Japanese RO"},keycodes[136]={id:"INT2",name:"ひらがな",desc:"Japanese Hiragana"},keycodes[137]={id:"INT3",name:"JIS ￥",desc:"Japanese Yen"},keycodes[138]={id:"INT4",name:"変換",desc:"Japanese Henkan"},keycodes[139]={id:"INT5",name:"無変換",desc:"Japanese Muhenkan"},keycodes[140]={id:"INT6",name:"INT6",desc:"INT6"},keycodes[141]={id:"INT7",name:"INT7",desc:"INT7"},keycodes[142]={id:"INT8",name:"INT8",desc:"INT8"},keycodes[143]={id:"INT9",name:"INT9",desc:"INT9"},keycodes[144]={id:"LANG1",name:"한/영",desc:"Korean Hangul/English"},keycodes[145]={id:"LANG2",name:"한자",desc:"Korean Hanja"},keycodes[146]={id:"LANG3",name:"LANG3",desc:"LANG3"},keycodes[147]={id:"LANG4",name:"LANG4",desc:"LANG4"},keycodes[148]={id:"LANG5",name:"LANG5",desc:"LANG5"},keycodes[149]={id:"LANG6",name:"LANG6",desc:"LANG6"},keycodes[150]={id:"LANG7",name:"LANG7",desc:"LANG7"},keycodes[151]={id:"LANG8",name:"LANG8",desc:"LANG8"},keycodes[152]={id:"LANG9",name:"LANG9",desc:"LANG9"},keycodes[176]={id:"P00",name:"00",desc:"Keypad 00, 极少数键盘未支持此功能"},keycodes[224]={id:"LCTL",name:"Ctrl",desc:"Left Control"},keycodes[225]={id:"LSFT",name:"Shift",desc:"Left Shift"},keycodes[226]={id:"LALT",name:"Alt",desc:"Left Alt",name_mac:"Option",desc_mac:"Left option⌥"},keycodes[227]={id:"LGUI",name:"Win",desc:"Left Windows",name_mac:"Cmd⌘",desc_mac:"Left command⌘"},keycodes[228]={id:"RCTL",name:"rCtrl",desc:"Right Control"},keycodes[229]={id:"RSFT",name:"rShift",desc:"Right Shift"},keycodes[230]={id:"RALT",name:"rAlt",desc:"Right Alt",name_mac:"rOption",desc_mac:"Right option⌥"},keycodes[231]={id:"RGUI",name:"rWin",desc:"Right Windows",name_mac:"rCmd⌘",desc_mac:"Right command⌘"},Object.freeze(keycodes);var extra_keycodes={358:{id:"MAC_POWER_MENU",name:'<i class="i_mac_powermenu fs32"></i>',desc:"Mac: 显示一个对话框，询问您是要重新启动、睡眠还是关机"},870:{id:"MAC_SCREENOFF",name:'<i class="i_mac_display_off fs32"></i>',desc:"Mac: 将显示器置于睡眠状态"},3174:{id:"MAC_SLEEP",name:'<i class="i_mac_powersleep fs32"></i>',desc:"Mac: 将您的 Mac 置于睡眠状态"}};function keyCode2tmkCode(e){var a={173:189,61:187,59:186,181:173,182:174,183:175,480:347,736:605};navigator.userAgent.indexOf("Firefox")>=0&&a[e]&&(e=a[e]);return{8:42,9:43,13:40,272:225,528:229,273:224,529:228,274:226,530:230,19:72,20:57,27:41,32:44,33:75,34:78,35:77,36:74,37:80,38:82,39:79,40:81,44:70,45:73,46:76,48:39,49:30,50:31,51:32,52:33,53:34,54:35,55:36,56:37,57:38,65:4,66:5,67:6,68:7,69:8,70:9,71:10,72:11,73:12,74:13,75:14,76:15,77:16,78:17,79:18,80:19,81:20,82:21,83:22,84:23,85:24,86:25,87:26,88:27,89:28,90:29,347:227,604:231,605:231,93:101,781:88,864:98,813:98,865:89,803:89,866:90,808:90,867:91,802:91,868:92,805:92,869:93,780:93,870:94,807:94,871:95,804:95,872:96,806:96,873:97,801:97,874:85,875:87,877:86,878:99,814:99,879:84,112:58,113:59,114:60,115:61,116:62,117:63,118:64,119:65,120:66,121:67,122:68,123:69,144:83,145:71,186:51,187:46,188:54,189:45,190:55,191:56,192:53,219:47,220:49,221:48,222:52,124:104,173:16610,174:16618,175:16617,183:16786,226:100}[e]}function keyName2tmkCode(e){return keyUnimap={KANA:"00",VOLDN:"40EA",VOLUP:"40E9",MUTE:"40E2",CALC:"4192",A:"04",B:"05",C:"06",D:"07",E:"08",F:"09",G:"0A",H:"0B",I:"0C",J:"0D",K:"0E",L:"0F",M:"10",N:"11",O:"12",P:"13",Q:"14",R:"15",S:"16",T:"17",U:"18",V:"19",W:"1A",X:"1B",Y:"1C",Z:"1D",1:"1E",2:"1F",3:"20",4:"21",5:"22",6:"23",7:"24",8:"25",9:"26",0:"27",ENTER:"28",ESC:"29",BS:"2A",BACKSPACE:"2A",TAB:"2B",SPACE:"2C","-":"2D","=":"2E","[":"2F","]":"30","\\":"31","ISO#":"32",";":"33","'":"34","`":"35",",":"36",".":"37","/":"38",CAPSLOCK:"39","CAPS LOCK":"39",F1:"3A",F2:"3B",F3:"3C",F4:"3D",F5:"3E",F6:"3F",F7:"40",F8:"41",F9:"42",F10:"43",F11:"44",F12:"45",PRTSCR:"46","PRINT SCREEN":"46",SCRLK:"47","SCROLL LOCK":"47",PAUSE:"48","PAUSE BREAK":"48",INS:"49",INSERT:"49",HOME:"4A",PGUP:"4B","PAGE UP":"4B",DEL:"4C",DELETE:"4C",END:"4D",PGDN:"4E","PAGE DOWN":"4E",RIGHT:"4F",LEFT:"50",DOWN:"51",UP:"52","NUM LOCK":"53",NUMLK:"53",NUMLOCK:"53","P/":"54","P*":"55","P-":"56","P+":"57",PENTER:"58",P1:"59",P2:"5A",P3:"5B",P4:"5C",P5:"5D",P6:"5E",P7:"5F",P8:"60",P9:"61",P0:"62","P.":"63","ISO\\":"64",MENU:"65","P,":"66","P=":"67",F13:"68",F14:"69",F15:"6A",F16:"6B",F17:"6C",F18:"6D",F19:"6E",F20:"6F",F21:"70",F22:"71",F23:"72",F24:"73",JYEN:"74",RO:"75",HENK:"76",MHEN:"77",CTRL:"78",SHIFT:"79",ALT:"7A",WIN:"7B",RCTRL:"7C",RSHIFT:"7D",RALT:"7E",RWIN:"7F",NO:"80"},keyUnimap[e]}function tmkCode2keyName(e){return keyName={0:"Kana",1:" ",2:" ",3:" ",4:"A",5:"B",6:"C",7:"D",8:"E",9:"F",10:"G",11:"H",12:"I",13:"J",14:"K",15:"L",16:"M",17:"N",18:"O",19:"P",20:"Q",21:"R",22:"S",23:"T",24:"U",25:"V",26:"W",27:"X",28:"Y",29:"Z",30:"1",31:"2",32:"3",33:"4",34:"5",35:"6",36:"7",37:"8",38:"9",39:"0",40:"Enter",41:"Esc",42:"Backspace",43:"Tab",44:"Space",45:"Minus",46:"Equal",47:"LeftBracket",48:"RightBracket",49:"BackSlash",50:"iso#",51:"Semicolon",52:"Quote",53:"Grave",54:"Comma",55:"Dot",56:"Slash",57:"Capslock",58:"F1",59:"F2",60:"F3",61:"F4",62:"F5",63:"F6",64:"F7",65:"F8",66:"F9",67:"F10",68:"F11",69:"F12",70:"PrtScr",71:"ScrLk",72:"Pause",73:"Insert",74:"Home",75:"PgUp",76:"Delete",77:"End",78:"PgDn",79:"Right",80:"Left",81:"Down",82:"Up",83:"Numlock",84:"PSlash",85:"PAster",86:"PMinus",87:"PPlus",88:"PEnter",89:"P1",90:"P2",91:"P3",92:"P4",93:"P5",94:"P6",95:"P7",96:"P8",97:"P9",98:"P0",99:"PDot",100:"iso\\",101:"Menu",102:"P,",103:"P=",104:"F13",105:"F14",106:"F15",107:"F16",108:"F17",109:"F18",110:"F19",111:"F20",112:"F21",113:"F22",114:"F23",115:"F24",116:"Jyen",117:"Ro",118:"Henk",119:"Mhen",120:"Ctrl",121:"Shift",122:"Alt",123:"Win",124:"RCtrl",125:"RShift",126:"RAlt",127:"RWin",128:"No",224:"Ctrl",225:"Shift",226:"Alt",227:"Win",228:"RCtrl",229:"RShift",230:"RAlt",231:"RWin",16618:"Voldn",16617:"VolUp",16610:"Mute",16786:"Calc"},keyName[e]}function shorten_date(e){var a=parseInt(e,10);return a<10?""+a:String.fromCharCode(a+55)}function keylabel_mac(e){return e.desc&&(e.desc=e.desc.replace("Alt","Option").replace(/Windows|Win|Gui/g,"Command").replace("Backspace","Delete").replace("Keypad Enter","PENT").replace("Enter","Return").replace("PENT","Keypad Enter").replace("Num Lock","Clear").replace("Insert","help").replace("Print Screen","F13(Mac)").replace("Scroll Lock","F14(Mac)").replace("Pause Break","F15(Mac)")),e.name&&(e.name=e.name.replace(/backspace|bs/i,"delete").replace(/caps lock/i,"caps<br>lock").replace(/enter/i,"return").replace(/ctrl/i,"control").replace(/short_ctl/i,"ctrl").replace(/alt/i,"option").replace(/win/i,"cmd⌘").replace(/print<br>scrn/i,"F13").replace(/scrll<br>lock/i,"F14").replace(/pause/i,"F15").replace(/ins/i,"help").replace(/p↩/i,"enter").replace(/p=/i,"=").replace(/num<br>lock/i,"clear")),e}function source_output(e){var a="";for(var t in a+='#include "action.h"\n',a+='#include "action_code.h"\n',a+='#include "actionmap.h"\n',a+="\n",a+="const action_t actionmaps[][",a+=e[0].length,a+="][",a+=e[0][0].length,a+='] __attribute__ ((section (".keymap.keymaps"))) = {\n',e){for(var s in a+="    {\n",e[t]){for(var o in a+="        { ",e[t][s])a+="0x"+("000"+e[t][s][o].toString(16)).substr(-4),a+=",";a+=" },\n"}a+="    },\n"}return a+="};\n"}function hex_line(e,a,t){var s=function(e){return("0"+e.toString(16)).substr(-2).toUpperCase()},o=0;o+=t.length,o+=e>>8,o+=255&e,o+=a;var n=":";n+=s(t.length),n+=s(e>>8),n+=s(255&e),n+=s(a);for(var i=0;i<t.length;i++)o+=t[i],n+=s(t[i]);return n+=s(1+~o&255)}function hex_eof(){return":00000001FF"}function hex_output(e,a){var t=[],s=[];return[].concat.apply([],[].concat.apply([],a)).forEach((function(a){s.push(a),16==s.length&&(t.push(hex_line(e,0,s)),e+=16,s.length=0)})),s.length>0&&(t+=hex_line(e,0,s)),t}function hex_keymaps(e){var a=[];return a=(a=[].concat.apply([],[].concat.apply([],keymaps))).map((function(e){return[255&e,(65280&e)>>8]})),hex_output(e,a=[].concat.apply([],a))}function get_fw_date_from_hex(e){for(var a=convert_hex2bin([].concat(e),0,KEYMAP_START_ADDRESS),t=new Array(0,0,0),s=0;s<a.length;s++)if(85==a[s]&&0==a[++s]&&83==a[++s]&&0==a[++s]&&66==a[++s]&&0==a[++s]&&95==a[++s]&&0==a[++s]&&68==a[++s]){console.log("find USB_D"),t[0]=a[s+2]-55,month_day_to_num=function(e){return e<=57?e-48:e>=65?e-55:void 0},t[1]=month_day_to_num(a[s+4]),t[2]=month_day_to_num(a[s+6]);break}return t[0]>=19&&t[1]>0&&t[1]<=12&&t[2]>0&&t[2]<=31?t:0}function hex_split_firmware(e,a,t){for(var s=[],o=[],n=[],i=s,d=0,c=e.split("\n"),r=0;r<c.length;r++){var l=c[r].trim();if(":020000040800F2"!=l){if(":"!=l.substring(0,1))break;var _=parseInt(l.substring(1,3),16),m=parseInt(l.substring(3,7),16),u=l.substring(7,9);if("00"==u)if(m+d<a)s.push(l),i=s;else if(m+d>=a+t)o.push(l),i=o;else for(var p=0,f=0;f<_;f++)f%2==1?n.push(parseInt(l.substring(9+2*f,11+2*f),16)<<8|p):p=parseInt(l.substring(9+2*f,11+2*f),16);else"04"==u?(0==s.length?i=s:(d=65536*parseInt(l.substring(9,13),16))>=a+t&&(i=o),i.push(l)):"01"==u?o.push(l):i.push(l)}}for(var y=[],k=[];n.length>0;)k.push(n.splice(0,16)),8==k.length&&(y.push(k),k=[]);return{before:s,after:o,keymaps:y,date:get_fw_date_from_hex(s)}}function bin_split_firmware(e,a,t,s){var o=[],n=[],i=[];null!=s&&(a-=s),console.log("bin keymap addr: 0x"+a.toString(16));var d=new Uint8Array(e.length);d.fill(255);for(var c=0;c<e.length;c++)d[c]=parseInt(e[c].charCodeAt(0),10);for(c=a;c<a+t;c++)i.push(d[c]|d[c+1]<<8),c++;for(c=a+t;c<e.length;c++)n[c-a-t]=d[c];for(var r=[],l=[];i.length>0;)l.push(i.splice(0,16)),8==l.length&&(r.push(l),l=[]);return{before:o,after:n,keymaps:r}}function url_encode_keymap(e){return"undefined"!=typeof LZString&&"undefined"!=typeof Base64?Base64.encode(LZString.compress(JSON.stringify(e))):window.btoa(JSON.stringify(e))}function url_decode_keymap(e){if(null==e||"string"!=typeof e||e.length<30)return null;var a=unzip(e);if(null!=a)return console.log("zip"),JSON.parse(a);try{return"undefined"!=typeof LZString&&"undefined"!=typeof Base64?(console.log("lz"),JSON.parse(LZString.decompress(Base64.decode(e))).keymaps):JSON.parse(window.atob(e)).keymaps}catch(e){return null}}function unzip(e){var a=atob(e),t=new pako.Inflate;if(t.push(a,!0),t.err)return null;var s=t.result;return strData=String.fromCharCode.apply(null,new Uint16Array(s)),strData}function zip(e){var a=pako.gzip(e,{to:"string"});return btoa(a)}function bin_to_uf2(e,a,t){for(var s=e.length+255>>8,o=[],n=0;n<e.length;n+=256){for(var i=new ArrayBuffer(512),d=new DataView(i),c=0;c<512;c++)d[c]=0;d.setUint32(0,171066965,!0),d.setUint32(4,2656915799,!0),d.setUint32(8,8192,!0),d.setUint32(12,a+n,!0),d.setUint32(16,256,!0),d.setUint32(20,o.length/512,!0),d.setUint32(24,s,!0),d.setUint32(28,t,!0);for(c=0;c<256;++c)d.setUint8(c+32,e[n+c]);d.setUint32(508,179400496,!0);for(c=0;c<512;c++)o.push(d.getUint8(c))}return new Uint8Array(o)}function uf2_to_bin(e){for(var a="",t=parseInt(e[13].charCodeAt(0),10)<<8|parseInt(e[12].charCodeAt(0),10),s=0;s<e.length;s+=512)for(var o=0;o<512;o++)o>=32&&o<288&&(a+=e[o+s]);return{binstr:a,bin_start_addr:t}}function load_hex_uf2(e){fetch(e).then(checkResponse).then(parseTEXT).then((function(e){var a=hex_split_firmware(e,63488,KEYMAP_SIZE);firmware_before_uf2=a.before}))}system_codes=[],system_codes[129]={id:"PWR ",name:'<i class="i_system_power fs32"></i>',desc:"System Power，适合Win10，仅有线模式下有效"},system_codes[130]={id:"SLEP",name:'<i class="i_system_sleep fs32"></i>',desc:"System Sleep，仅有线模式下有效"},system_codes[131]={id:"WAKE",name:'<i class="i_system_wake fs32"></i>',desc:"System Wake，仅有线模式下有效"},Object.freeze(system_codes),consumer_codes={111:{id:"SBUP",name:' <i style="padding-left:6px" class="kb kb-Unicode-Screen-Bright fs24"/>',desc:"增大屏幕亮度，需要设备本身支持此功能，系统要求win8以上/Mac/iOS/iPadOS"},112:{id:"SBDN",name:' <i style="padding-left:6px" class="kb kb-Unicode-Screen-Dim fs24"/>',desc:"降低屏幕亮度，需要设备本身支持此功能，系统要求win8以上/Mac/iOS/iPadOS"},226:{id:"MUTE",name:' <i class="kb kb-Multimedia-Mute-2 fs22"/>',desc:"静音"},233:{id:"VOLU",name:' <i class="kb kb-Multimedia-Volume-Up-2 fs22"/>',desc:"音量加"},234:{id:"VOLD",name:' <i class="kb kb-Multimedia-Volume-Down-2 fs22"/>',desc:"音量减"},181:{id:"MNXT",name:' <i class="fa fa-step-forward fs20"/>',desc:"下一曲"},182:{id:"MPRV",name:' <i class="fa fa-step-backward fs20"/>',desc:"上一曲"},183:{id:"MSTP",name:' <i class="fa fa-stop fs20"/>',desc:"停止播放"},184:{id:"EJCT",name:' <i class="material-icons fs22">keyboard_hide</i>',desc:"显示或隐藏iOS/iPadOS虚拟键盘"},205:{id:"MPLY",name:' <i class="fa fa-play fs20"/>',desc:"播放/暂停"},387:{id:"MSEL",name:' <i class="fa fa-music fs20"/>',desc:"启动默认音乐播放器"},394:{id:"MAIL",name:' <i class="fa fa-envelope fs20"></i>',desc:"邮件"},402:{id:"CALC",name:' <i class="fa fa-calculator fs22"/>',desc:"计算器，仅Windows下有效"},404:{id:"MYCM",name:' <i class="fa fa-desktop fs20"></i>',desc:"资源管理器，仅Windows下有效"},545:{id:"WSCH",name:'<i class="i_www_search fs32"></i>',desc:"浏览器： 搜索"},547:{id:"WHOM",name:'<i class="i_www_home fs32"></i>',desc:"浏览器： 主页"},548:{id:"WBAK",name:'<i class="i_www_back fs32"></i>',desc:"浏览器： 后退"},549:{id:"WFWD",name:'<i class="i_www_forward fs32"></i>',desc:"浏览器： 前进"},550:{id:"WSTP",name:'<i class="i_www_stop fs32"></i>',desc:"浏览器： 停止"},551:{id:"WREF",name:'<i class="i_www_refresh fs32"></i>',desc:"浏览器： 刷新"},554:{id:"WFAV",name:'<i class="i_www_favorites fs32"></i>',desc:"浏览器： 收藏夹"},179:{id:"MFFD",name:"Fast Forward",desc:"Media Fast Forward(Mac)"},180:{id:"MRWD",name:"Rewind",desc:"Media Rewind(Mac)"}},Object.freeze(consumer_codes),mousekey_codes=[],mousekey_codes[240]={id:"MS_U",name:'<i class="i_mouse_move_up fs32"></i>',desc:"鼠标： 上移"},mousekey_codes[241]={id:"MS_D",name:'<i class="i_mouse_move_down fs32"></i>',desc:"鼠标： 下移"},mousekey_codes[242]={id:"MS_L",name:'<i class="i_mouse_move_left fs32"></i>',desc:"鼠标： 左移"},mousekey_codes[243]={id:"MS_R",name:'<i class="i_mouse_move_right fs32"></i>',desc:"鼠标： 右移"},mousekey_codes[244]={id:"BTN1",name:'<i class="i_mouse_left fs32"></i>',desc:"鼠标: 点击左键"},mousekey_codes[245]={id:"BTN2",name:'<i class="i_mouse_right fs32"></i>',desc:"鼠标: 点击右键"},mousekey_codes[246]={id:"BTN3",name:'<i class="i_mouse_middle fs32"></i>',desc:"鼠标: 点击中键"},mousekey_codes[247]={id:"BTN4",name:'<i class="i_mouse_back fs32"></i>',desc:"鼠标: 点击后退"},mousekey_codes[248]={id:"BTN5",name:'<i class="i_mouse_forward fs32"></i>',desc:"鼠标: 点击前进"},mousekey_codes[249]={id:"WH_U",name:'<i class="i_mouse_wheel_up fs32"></i>',desc:"鼠标: 滚轮 上"},mousekey_codes[250]={id:"WH_D",name:'<i class="i_mouse_wheel_down fs32"></i>',desc:"鼠标: 滚轮 下"},mousekey_codes[251]={id:"WH_L",name:'<i class="i_mouse_wheel_left fs32"></i>',desc:"鼠标: 滚轮 左"},mousekey_codes[252]={id:"WH_R",name:'<i class="i_mouse_wheel_right fs32"></i>',desc:"鼠标: 滚轮 右"},mousekey_codes[253]={id:"ACL0",name:'<i class="i_mouse_speed_slow fs32"></i>',desc:'按住此键，再按鼠标移动键时，鼠标指针"慢速"匀速移动'},mousekey_codes[254]={id:"ACL1",name:'<i class="i_mouse_speed_medium fs32"></i>',desc:'按住此键，再按鼠标移动键时，鼠标指针"中速"匀速移动'},mousekey_codes[255]={id:"ACL2",name:'<i class="i_mouse_speed_fast fs32"></i>',desc:'按住此键，再按鼠标移动键时，鼠标指针"快速"匀速移动'},mousekey_codes[0]={id:"BTN1_",name:"火力左键",desc:"火力模式按键 鼠标左键"},mousekey_codes[4]={id:"A",name:"火A",desc:"火力模式按键 A"},mousekey_codes[5]={id:"B",name:"火B",desc:"火力模式按键 B"},mousekey_codes[6]={id:"C",name:"火C",desc:"火力模式按键 C"},mousekey_codes[7]={id:"D",name:"火D",desc:"火力模式按键 D"},mousekey_codes[8]={id:"E",name:"火E",desc:"火力模式按键 E"},mousekey_codes[9]={id:"F",name:"火F",desc:"火力模式按键 F"},mousekey_codes[10]={id:"G",name:"火G",desc:"火力模式按键 G"},mousekey_codes[11]={id:"H",name:"火H",desc:"火力模式按键 H"},mousekey_codes[12]={id:"I",name:"火I",desc:"火力模式按键 I"},mousekey_codes[13]={id:"J",name:"火J",desc:"火力模式按键 J"},mousekey_codes[14]={id:"K",name:"火K",desc:"火力模式按键 K"},mousekey_codes[15]={id:"L",name:"火L",desc:"火力模式按键 L"},mousekey_codes[16]={id:"M",name:"火M",desc:"火力模式按键 M"},mousekey_codes[17]={id:"N",name:"火N",desc:"火力模式按键 N"},mousekey_codes[18]={id:"O",name:"火O",desc:"火力模式按键 O"},mousekey_codes[19]={id:"P",name:"火P",desc:"火力模式按键 P"},mousekey_codes[20]={id:"Q",name:"火Q",desc:"火力模式按键 Q"},mousekey_codes[21]={id:"R",name:"火R",desc:"火力模式按键 R"},mousekey_codes[22]={id:"S",name:"火S",desc:"火力模式按键 S"},mousekey_codes[23]={id:"T",name:"火T",desc:"火力模式按键 T"},mousekey_codes[24]={id:"U",name:"火U",desc:"火力模式按键 U"},mousekey_codes[25]={id:"V",name:"火V",desc:"火力模式按键 V"},mousekey_codes[26]={id:"W",name:"火W",desc:"火力模式按键 W"},mousekey_codes[27]={id:"X",name:"火X",desc:"火力模式按键 X"},mousekey_codes[28]={id:"Y",name:"火Y",desc:"火力模式按键 Y"},mousekey_codes[29]={id:"Z",name:"火Z",desc:"火力模式按键 Z"},mousekey_codes[30]={id:"1",name:"火1",desc:"火力模式按键 1 !"},mousekey_codes[31]={id:"2",name:"火2",desc:"火力模式按键 2 @"},mousekey_codes[32]={id:"3",name:"火3",desc:"火力模式按键 3 #"},mousekey_codes[33]={id:"4",name:"火4",desc:"火力模式按键 4 $"},mousekey_codes[34]={id:"5",name:"火5",desc:"火力模式按键 5 %"},mousekey_codes[35]={id:"6",name:"火6",desc:"火力模式按键 6 ^"},mousekey_codes[36]={id:"7",name:"火7",desc:"火力模式按键 7 &"},mousekey_codes[37]={id:"8",name:"火8",desc:"火力模式按键 8 *"},mousekey_codes[38]={id:"9",name:"火9",desc:"火力模式按键 9 ("},mousekey_codes[39]={id:"0",name:"火0",desc:"火力模式按键 0 )"},mousekey_codes[62]={id:"F5",name:"火F5",desc:"火力模式按键 F5"},Object.freeze(mousekey_codes),mods_codes=[],mods_codes[0]={id:0,name:"    ",desc:"none"},mods_codes[1]={id:1,name:"Ctrl",desc:"Control"},mods_codes[2]={id:2,name:"Shift",desc:"Shift"},mods_codes[3]={id:3,name:"Shift+Ctrl",desc:"Shift + Control"},mods_codes[4]={id:4,name:"Alt",desc:"Alt"},mods_codes[5]={id:5,name:"Alt+Ctrl",desc:"Alt + Control"},mods_codes[6]={id:6,name:"Alt+Shift",desc:"Alt + Shift"},mods_codes[7]={id:7,name:"Alt+Shift+Ctrl",desc:"Alt + Shift + Control"},mods_codes[8]={id:8,name:"Win",desc:"Win"},mods_codes[9]={id:9,name:"Win+Ctrl",desc:"Win + Control"},mods_codes[10]={id:10,name:"Win+Shift",desc:"Win + Shift"},mods_codes[11]={id:11,name:"Win+Shift+Ctrl",desc:"Win + Shift + Control"},mods_codes[12]={id:12,name:"Win+Alt",desc:"Win + Alt"},mods_codes[13]={id:13,name:"Win+Alt+Ctrl",desc:"Win + Alt + Control"},mods_codes[14]={id:14,name:"Win+Alt+Shift",desc:"Win + Alt + Shift"},mods_codes[15]={id:15,name:"Win+Alt+Shift+Ctrl",desc:"Win + Alt + Shift + Control"},mods_codes[16]={id:16,name:"    ",desc:"none"},mods_codes[17]={id:17,name:"rCtrl",desc:"rControl"},mods_codes[18]={id:18,name:"rShift",desc:"rShift"},mods_codes[19]={id:19,name:"rShift+rCtrl",desc:"rShift + rControl"},mods_codes[20]={id:20,name:"rAlt",desc:"rAlt"},mods_codes[21]={id:21,name:"rAlt+rCtrl",desc:"rAlt + rControl"},mods_codes[22]={id:22,name:"rAlt+rShift",desc:"rAlt + rShift"},mods_codes[23]={id:23,name:"rAlt+rShift+rCtrl",desc:"rAlt + rShift + rControl"},mods_codes[24]={id:24,name:"rWin",desc:"rWin"},mods_codes[25]={id:25,name:"rWin+rCtrl",desc:"rWin + rControl"},mods_codes[26]={id:26,name:"rWin+rShift",desc:"rWin + rShift"},mods_codes[27]={id:27,name:"rWin+rShift+rCtrl",desc:"rWin + rShift + rControl"},mods_codes[28]={id:28,name:"rWin+rAlt",desc:"rWin + rAlt"},mods_codes[29]={id:29,name:"rWin+rAlt+rCtrl",desc:"rWin + rAlt + rControl"},mods_codes[30]={id:30,name:"rWin+rAlt+rShift",desc:"rWin + rAlt + rShift"},mods_codes[31]={id:31,name:"rWin+rAlt+rShift+rCtrl",desc:"rWin + rAlt + rShift + rControl"},Object.freeze(mods_codes),on_codes=[],on_codes[1]={id:1,name:"On Press",desc:"On Press"},on_codes[2]={id:1,name:"On Release",desc:"On Release"},on_codes[3]={id:1,name:"On Both",desc:"On Press and Release"},am_codes=[],am_codes[0]={id:"未知",name:"未知",desc:"未知"},af_codes=[],af_codes[0]={id:"未知",name:"未知",desc:"未知"},KEYMAP_LAYERS=8,KEYMAP_ROW=8,KEYMAP_COL=16,no_map=function(){return new Array(8).fill(0).map((e=>new Array(16).fill(0)))},transparent_map=function(){return new Array(8).fill(1).map((e=>new Array(16).fill(1)))},keymaps=[[[136,17642,17641,17634,4,5,6,7,8,9,10,11,12,13,14,15],[16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],[32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47],[48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63],[64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79],[80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95],[96,97,98,99,100,101,133,103,20724,20725,20726,20727,20728,20729,20730,111],[112,113,114,115,137,135,138,139,224,225,226,227,228,229,230,231]],transparent_map(),transparent_map(),transparent_map(),transparent_map(),transparent_map(),transparent_map(),transparent_map()],KEYMAP_START_ADDRESS=26624,KEYMAP_SIZE=2048,ACT_MODS=0,ACT_LMODS=0,ACT_RMODS=1,ACT_MODS_TAP=2,ACT_LMODS_TAP=2,ACT_RMODS_TAP=3,ACT_USAGE=4,ACT_MOUSEKEY=5,ACT_LAYER=8,ACT_LAYER_EXT=9,ACT_LAYER_TAP=10,ACT_LAYER_TAP_EXT=11,ACT_MACRO=12,ACT_BACKLIGHT=13,ACT_COMMAND=14,ACT_FUNCTION=15,OP_TAP_TOGGLE=240,OP_ON_OFF=241,OP_OFF_ON=242,OP_SET_CLEAR=243,OP_BIT_AND=0,OP_BIT_OR=1,OP_BIT_XOR=2,OP_BIT_SET=3,ON_SPECIAL_USE=0,ON_PRESS=1,ON_RELEASE=2,ON_BOTH=3,MOD_LCTL=1,MOD_LSFT=2,MOD_LALT=4,MOD_LGUI=8,MOD_RCTL=17,MOD_RSFT=18,MOD_RALT=20,MOD_RGUI=24,MODS_ONESHOT=0,MODS_TAP_TOGGLE=1,PAGE_CONSUMER=0,PAGE_SYSTEM=1,FUNC_TAP=8;var kind_codes={KEY:ACT_MODS<<12,MODS_KEY:ACT_MODS<<12,MODS_TAP_KEY:ACT_MODS_TAP<<12,MODS_ONESHOT:ACT_MODS_TAP<<12|MODS_ONESHOT,MODS_TAP_TOGGLE:ACT_MODS_TAP<<12|MODS_TAP_TOGGLE,USAGE_SYSTEM:ACT_USAGE<<12|PAGE_SYSTEM<<10,USAGE_CONSUMER:ACT_USAGE<<12|PAGE_CONSUMER<<10,MOUSEKEY:ACT_MOUSEKEY<<12,MACRO:ACT_MACRO<<12,MACRO_TAP:ACT_MACRO<<12,MACRO_OPT:ACT_MACRO<<12,FUNCTION:ACT_FUNCTION<<12,FUNCTION_TAP:ACT_FUNCTION<<12|FUNC_TAP<<8,FUNCTION_OPT:ACT_FUNCTION<<12,LAYER_CLEAR:ACT_LAYER<<12|OP_BIT_AND<<10,LAYER_MOMENTARY:ACT_LAYER_TAP<<12|OP_ON_OFF,LAYER_TOGGLE:ACT_LAYER<<12|OP_BIT_XOR<<10|ON_RELEASE<<8,LAYER_INVERT:ACT_LAYER<<12|OP_BIT_XOR<<10,LAYER_ON:ACT_LAYER<<12|OP_BIT_OR<<10,LAYER_OFF:ACT_LAYER<<12|OP_BIT_AND<<10,LAYER_SET:ACT_LAYER<<12|OP_BIT_SET<<10,LAYER_TAP_KEY:ACT_LAYER_TAP<<12,LAYER_MODS:ACT_LAYER_TAP<<12|224,LAYER_TAP_TOGGLE:ACT_LAYER_TAP<<12|OP_TAP_TOGGLE,LAYER_ON_OFF:ACT_LAYER_TAP<<12|OP_ON_OFF,LAYER_OFF_ON:ACT_LAYER_TAP<<12|OP_OFF_ON,LAYER_SET_CLEAR:ACT_LAYER_TAP<<12|OP_SET_CLEAR,LAYER_BIT_AND:ACT_LAYER<<12|OP_BIT_AND<<10,LAYER_BIT_OR:ACT_LAYER<<12|OP_BIT_OR<<10,LAYER_BIT_XOR:ACT_LAYER<<12|OP_BIT_XOR<<10,LAYER_BIT_SET:ACT_LAYER<<12|OP_BIT_SET<<10,DEFAULT_LAYER_SET:ACT_LAYER<<12|OP_BIT_SET<<10|ON_SPECIAL_USE<<8,UNKNOWN:0};function Action(e){this.code=e,Object.defineProperty(this,"kind",{set:function(e){this.code|=(15&e)<<12},get:function(){return(61440&this.code)>>12}}),Object.defineProperty(this,"key_mods",{set:function(e){this.code|=(31&e)<<8},get:function(){return(7936&this.code)>>8}}),Object.defineProperty(this,"key_code",{set:function(e){this.code|=255&e},get:function(){return 255&this.code}}),Object.defineProperty(this,"usage_page",{set:function(e){this.code|=(3&e)<<10},get:function(){return(3072&this.code)>>10}}),Object.defineProperty(this,"usage_code",{set:function(e){this.code|=1023&e},get:function(){return 1023&this.code}}),Object.defineProperty(this,"layer_tap_val",{set:function(e){this.code|=(31&e)<<8},get:function(){return(7936&this.code)>>8}}),Object.defineProperty(this,"layer_tap_code",{set:function(e){this.code|=255&e},get:function(){return 255&this.code}}),Object.defineProperty(this,"layer_bitop_op",{set:function(e){this.code|=(3&e)<<10},get:function(){return(3072&this.code)>>10}}),Object.defineProperty(this,"layer_bitop_on",{set:function(e){this.code|=(3&e)<<8},get:function(){return(768&this.code)>>8}}),Object.defineProperty(this,"layer_bitop_part",{set:function(e){this.code|=(7&e)<<5},get:function(){return(224&this.code)>>5}}),Object.defineProperty(this,"layer_bitop_xbit",{set:function(e){this.code|=(1&e)<<4},get:function(){return(16&this.code)>>4}}),Object.defineProperty(this,"layer_bitop_bits",{set:function(e){this.code|=15&e},get:function(){return 15&this.code}}),Object.defineProperty(this,"mousekey_code",{set:function(e){this.code|=255&e},get:function(){return 255&this.code}}),Object.defineProperty(this,"am_code",{set:function(e){this.code|=15&e},get:function(){return 4095&this.code}}),Object.defineProperty(this,"af_code",{set:function(e){this.code|=15&e},get:function(){return 4095&this.code}});var a=function(e){var a="",t=[];return 1&e&&(a+="⌃",t.push("Control")),2&e&&(a+="⇧",t.push("Shift")),4&e&&(a+="⌥",t.push("Alt")),8&e&&(a+="⌘",t.push("Gui")),t=t.join(" + "),1==a.length?(a=mods_codes[e].name,16&e&&(t="Right "+t)):16&e&&(a="r"+a,t="Right "+t),{name:a,desc:t}};this.get_action=function(){switch((61440&this.code)>>12){case ACT_LMODS:case ACT_RMODS:if(0==this.key_mods){if(keycodes[this.key_code])return $.extend({},action_kinds.KEY,{name_dsa:keycodes[this.key_code].name_dsa,name:keycodes[this.key_code].name,desc:keycodes[this.key_code].desc})}else{if(extra_keycodes[this.code])return $.extend({},action_kinds.KEY,{name_dsa:extra_keycodes[this.code].name_dsa,name:extra_keycodes[this.code].name,desc:extra_keycodes[this.code].desc});if(keycodes[this.key_code]){var e=a(this.key_mods);if(2==this.key_mods&&kc_symbol(this.key_code))var t='<i class="midfont">'+keycodes[this.key_code].name.substring(0,1)+"</i>",s='<i class="midfont">'+keycodes[this.key_code].name.substring(0,1)+"</i>",o="直接输出标点 <kt>{0}</kt>, 等效于 <kt>{1}</kt> + <kt>{2}</kt>".format(keycodes[this.key_code].name.substring(0,1),e.desc,keycodes[this.key_code].desc);else{t=e.name+"+<br>"+keycodes[this.key_code].name_dsa;keycodes[this.key_code].name_dsa&&(t=e.name+"+<br>"+keycodes[this.key_code].name_dsa.replace("<br>"," "));s=e.name+"+<br>"+keycodes[this.key_code].name.replace("<br>"," "),o="<kt>{0}</kt> + <kt>{1}</kt>".format(e.desc,keycodes[this.key_code].desc)}return $.extend({},action_kinds.MODS_KEY,{name_dsa:t,name:s,desc:o})}}break;case ACT_LMODS_TAP:case ACT_RMODS_TAP:e=a(this.key_mods);switch(this.key_code){case MODS_ONESHOT:return $.extend({},action_kinds.MODS_ONESHOT,{name:e.name+" OneShot",desc:e.desc+" OneShot"});case MODS_TAP_TOGGLE:return $.extend({},action_kinds.MODS_TAP_TOGGLE,{name:e.name+" TapToggle",desc:e.desc+" TapToggle"})}if(null==keycodes[this.key_code])break;(r=keycodes[this.key_code].name_dsa)&&(r=r.replace("<br>"," "));var n=keycodes[this.key_code].name.replace("<br>"," ");return $.extend({},action_kinds.MODS_TAP_KEY,{name_dsa:e.name+"|<br>"+r,name:e.name+"|<br>"+n,desc:"长按及与其他键组合时：<kt>{0}</kt> ；<br>快速单击时为 <kt>{1}</kt>".format(e.desc,keycodes[this.key_code].desc)});case ACT_LAYER:var i=1==this.layer_bitop_bits||2==this.layer_bitop_bits||4==this.layer_bitop_bits||8==this.layer_bitop_bits;switch(this.layer_bitop_op){case OP_BIT_AND:return action_kinds.LAYER_BIT_AND;case OP_BIT_OR:return action_kinds.LAYER_BIT_OR;case OP_BIT_XOR:if(this.layer_bitop_on==ON_RELEASE&&0==this.layer_bitop_xbit&&i){for(var d=4*this.layer_bitop_part,c=this.layer_bitop_bits;c>>1;c>>=1)d++;return $.extend({},action_kinds.LAYER_TOGGLE,{name:"T"+d,desc:"点击打开或关闭 层<kt>{0}</kt>".format(d)})}return action_kinds.LAYER_BIT_XOR;case OP_BIT_SET:if(this.layer_bitop_on==ON_SPECIAL_USE&&0==this.layer_bitop_xbit&&i){for(d=4*this.layer_bitop_part,c=this.layer_bitop_bits;c>>1;c>>=1)d++;return $.extend({},action_kinds.DEFAULT_LAYER_SET,{name:"默认 层"+d,desc:"设置默认层 层"+d})}if(this.layer_bitop_on==ON_PRESS&&0==this.layer_bitop_xbit&&i){for(d=4*this.layer_bitop_part,c=this.layer_bitop_bits;c>>1;c>>=1)d++;return $.extend({},action_kinds.UNKNOWN,{name:"T->"+d,desc:"跳转到 层<kt>{0}</kt>".format(d)})}return action_kinds.UNKNOWN}break;case ACT_LAYER_EXT:break;case ACT_LAYER_TAP:case ACT_LAYER_TAP_EXT:switch(this.layer_tap_code){case OP_TAP_TOGGLE:return $.extend({},action_kinds.LAYER_TAP_TOGGLE,{name:"LT"+this.layer_tap_val,desc:"Switch Layer "+this.layer_tap_val+" with Tap toggle"});case OP_ON_OFF:n="L"+this.layer_tap_val;return 1==this.layer_tap_val&&(n="Fn/"+n),$.extend({},action_kinds.LAYER_MOMENTARY,{name:n,desc:"瞬时开启（按下开启，松开关闭） 层<kt>{0}</kt>".format(this.layer_tap_val)});case OP_OFF_ON:return action_kinds.LAYER_OFF_ON;case OP_SET_CLEAR:return action_kinds.LAYER_SET_CLEAR;default:if(224==(240&this.layer_tap_code)){e=a(15&this.layer_tap_code);return $.extend({},action_kinds.LAYER_MODS,{name:"LM"+this.layer_tap_val+"<br>"+e.name,desc:"瞬时开启 层<kt>{0}</kt>, 同时按住 <kt>{1}</kt>".format(this.layer_tap_val,e.desc)})}if(null==keycodes[this.key_code])break;var r;this.layer_tap_val<8?layer_tap_s=this.layer_tap_val:this.layer_tap_val<16?layer_tap_s=(7&this.layer_tap_val)+"(S)":this.layer_tap_val<24&&(layer_tap_s=(7&this.layer_tap_val)+"(P)"),(r=keycodes[this.key_code].name_dsa)&&(r=r.replace("<br>"," "));n=keycodes[this.key_code].name.replace("<br>"," ");return $.extend({},action_kinds.LAYER_TAP_KEY,{name_dsa:"LT"+layer_tap_s+"<br>"+r,name:"LT"+layer_tap_s+"<br>"+n,desc:"长按及与其他键组合时，瞬时开启 层<kt>{0}</kt> ；<br>快速单击时为 <kt>{1}</kt>".format(layer_tap_s,keycodes[this.layer_tap_code].desc)})}break;case ACT_USAGE:switch(this.usage_page){case PAGE_SYSTEM:if(system_codes[this.usage_code])return $.extend({},action_kinds.USAGE_SYSTEM,{name:system_codes[this.usage_code].name,desc:system_codes[this.usage_code].desc});case PAGE_CONSUMER:if(consumer_codes[this.usage_code])return $.extend({},action_kinds.USAGE_CONSUMER,{name:consumer_codes[this.usage_code].name,desc:consumer_codes[this.usage_code].desc})}break;case ACT_MOUSEKEY:if(mousekey_codes[this.mousekey_code])return $.extend({},action_kinds.MOUSEKEY,{name:mousekey_codes[this.mousekey_code].name,desc:mousekey_codes[this.mousekey_code].desc});break;case ACT_MACRO:if(am_codes[this.am_code])return $.extend({},action_kinds.MACRO,{name:am_codes[this.af_code].name,desc:am_codes[this.af_code].desc});break;case ACT_FUNCTION:if(af_codes[this.af_code])return $.extend({},action_kinds.FUNCTION,{name:af_codes[this.af_code].name,desc:af_codes[this.af_code].desc})}return action_kinds.UNKNOWN},Object.defineProperty(this,"id",{get:function(){return this.get_action().id}}),Object.defineProperty(this,"name",{get:function(){var e=this.get_action();return null!=e?e.name:""}}),Object.defineProperty(this,"name_dsa",{get:function(){var e=this.get_action();if(null!=e)return e.name_dsa}}),Object.defineProperty(this,"desc",{get:function(){var e=this.get_action();return null!=e?e.desc:""}})}function action_editor_get_code(){var e=$("#kind_dropdown-btn").attr("value"),a=parseInt($("#keycodes_dropdown-btn").attr("value")),t=parseInt($("#keycodes4tap_dropdown-btn").attr("value")),s=parseInt($("#key_mods_dropdown-btn").attr("value")),o=parseInt($("#layer_dropdown-btn").attr("value")),n=parseInt($("#layer_tap_dropdown-btn").attr("value")),i=parseInt($("#layer_mods_dropdown-btn").attr("value")),d=parseInt($("#layer_on_dropdown-btn").attr("value")),c=parseInt($("#launch_shortcut_dropdown-btn").attr("value"));switch(e){case"KEY":return kind_codes[e]|a;case"MODS_KEY":return kind_codes[e]|s<<8|a;case"MODS_TAP_KEY":return kind_codes[e]|s<<8|t;case"MODS_ONESHOT":case"MODS_TAP_TOGGLE":return kind_codes[e]|s<<8;case"USAGE_SYSTEM":return kind_codes[e]|system_code;case"USAGE_CONSUMER":return kind_codes[e]|consumer_code;case"MOUSEKEY":return kind_codes[e]|mousekey_code;case"LAYER_MOMENTARY":case"LAYER_ON_OFF":case"LAYER_OFF_ON":case"LAYER_SET_CLEAR":case"LAYER_TAP_TOGGLE":return kind_codes[e]|o<<8;case"LAYER_TAP_KEY":return kind_codes[e]|n<<8|t;case"LAYER_MODS":return kind_codes[e]|o<<8|i;case"LAYER_INVERT":case"LAYER_ON":case"LAYER_OFF":case"LAYER_SET":return kind_codes[e]|d<<8|o/4<<5|1<<o%4;case"LAYER_TOGGLE":return kind_codes[e]|o/4<<5|1<<o%4;case"LAYER_CLEAR":return 0|(kind_codes[e]|d<<8);case"DEFAULT_LAYER_SET":return 0|kind_codes[e]|o/4<<5|1<<o%4;case"LAUNCH_SHORTCUT":return c}return 0}function update_copyright(){var e=(new Date).getFullYear()-2016,a=0,t=setInterval((function(){++a>=e&&clearInterval(t),$("#tyear").text(2016+a)}),1e3)}async function fetchHeader(e,a){return(await fetch(e)).headers.get(a)}function format_date(e){dateDigitToString=function(e){return e<10?"0"+e:e};var a=dateDigitToString(e.getFullYear()),t=dateDigitToString(e.getMonth()+1),s=dateDigitToString(e.getDate()),o=a+"-"+t+"-"+s+" "+dateDigitToString(e.getHours())+":"+dateDigitToString(e.getMinutes())+":"+dateDigitToString(e.getSeconds());return last_modified_date_short=shorten_date(a%100)+shorten_date(t)+shorten_date(s),console.log("Latest firmware: "+last_modified_date_short+" "+o),{short:last_modified_date_short,long:o}}function checkResponse(e){if(e.status>=200&&e.status<300)return e;var a=new Error(e.statusText);throw a.response=e,a}function parseTEXT(e){return e.text()}function parseJSON(e){return e.json()}$((function(){$("#kind_dropdown").change((function(e){let a="";a+="kind";var t=$("#kind_dropdown-btn").attr("value");switch(t){case"KEY":a+=" keycodes";break;case"MODS_KEY":a+=" keycodes",a+=" key_mods";break;case"MODS_TAP_KEY":a+=" keycodes4tap",a+=" key_mods";break;case"MODS_ONESHOT":case"MODS_TAP_TOGGLE":a+=" key_mods";break;case"LAYER_MOMENTARY":case"LAYER_ON_OFF":case"LAYER_OFF_ON":case"LAYER_SET_CLEAR":case"LAYER_TAP_TOGGLE":case"LAYER_TOGGLE":case"DEFAULT_LAYER_SET":a+=" layer";break;case"LAYER_TAP_KEY":a+=" keycodes4tap",a+=" layer_tap";break;case"LAYER_MODS":a+=" layer",a+=" layer_mods";break;case"LAYER_INVERT":case"LAYER_ON":case"LAYER_OFF":case"LAYER_SET":a+=" layer",a+=" layer_on";break;case"LAYER_CLEAR":a+=" layer_on";break;case"LAUNCH_SHORTCUT":a+=" launch_shortcut"}$("#fn-set").find("[id$=_dropdown-btn]").each((function(){let e=this.id.slice(0,-13);if(a.split(" ").includes(e))$(this).addClass("showf").removeClass("hidef hidden");else if("block"==$(this).css("display")){$(this).addClass("hidef").removeClass("showf");var s=$(this);setTimeout((function(){s.addClass("hidden")}),300)}"LAYER_MODS"==t&&$("#layer_mods_dropdown").find("li").each((function(){$(this).attr("value")>=15?$(this).hide():$(this).show()})),$("#keycodes_dropdown").find("li").each((function(){$(this).attr("value")>=224&&("MODS_KEY"==t?$(this).hide():$(this).show())}))}))}))})),$((function(){$("#display-layout-info").click((function(){if(0==$("#keyboard-outline").find(".keycap-length").length){var e=0,a=0;$("#keyboard-outline").find(".key:visible").each((function(){var t=$(this).parents().parents().parents().attr("class"),s=t.match(/.*? w(\d+).*?/),o=t.match(/.*? h(\d+).*?/);if(!t.match(/.*?round|square|keylarger150.*?/)){e++;var n=0;if(1.5==(s=s?s[1]/100:o?o[1]/100:1)&&o&&200==o[1]&&(s+="/2",n=2),$(this).attr("length",s+"u"),s>=2&&s<=2.75?n=2:s>=3&&(n=s),n>0){var i=n+("zh_cn"==NOW_LANG?"u 卫星轴":"u stabilizer");$(this).attr("stabilizer",i)}var d=$(this);setTimeout((function(){d.attr("length")&&d.removeClass("fade-in-down fade-in-up").addClass("fade-out-down")}),15*e),setTimeout((function(){a++;var t=d.attr("length"),s=("<br>"+d.attr("stabilizer")).replace(/<br>undefined/,"");t&&(d.removeClass("fade-out-down").addClass("fade-in-down"),d.html('<span class="keycap-length">{0}</span>{1}'.format(t,s)),d.removeAttr("length stabilizer")),$("#this_layout_keys").text(a),a==e&&setTimeout((function(){$("#keyboard-outline").find(".homing").find(".key").removeClass("fade-in-down fade-in-up")}),15)}),15*e+200)}})),$("#layout-info-pane").css("display","").removeClass("hidef").addClass("showf")}else $("#layer_set").tabs("select","layer_0")}))})),String.prototype.format=function(){var e=this;for(var a in arguments){var t=new RegExp("\\{"+a+"\\}","gi");e=e.replace(t,arguments[a])}return e};var $jsonp=function(){var e={send:function(e,a){var t=a.callbackName||"callback",s=a.onSuccess||function(){},o=a.onTimeout||function(){},n=a.timeout||10,i=window.setTimeout((function(){window[t]=function(){},o()}),1e3*n);window[t]=function(e){window.clearTimeout(i),s(e)};var d=document.createElement("script");d.type="text/javascript",d.async=!0,d.src=e,document.getElementsByTagName("head")[0].appendChild(d),d.parentNode.removeChild(d)}};return e}();function fadeToggle(e,a){a=a||16.6;if(0==e.style.opacity){e.style.display="block";var t=0,s=setInterval((function(){t++,e.style.opacity=t/20,t>=20&&clearInterval(s)}),a)}else if(1==e.style.opacity)t=20,s=setInterval((function(){t--,e.style.opacity=t/20,0==t&&(e.style.display="none",clearInterval(s))}),a)}function add_some_css_to_head(){var e="";for(let a=8;a<=33;a++)e+=`.fs${a} {font-size: ${a}px;}`;for(let a=1;a<=30;a++)e+=`.key-set.spc${25*a} {margin-left:${50*a/4+4}px;}`;for(let a=1;a<=40;a++)e+=`.key-set.w${25*a} {width:${50*a/4-8}px;}`;var a=54;for(let t=1;t<=100;t++)e+=`.col${25*t} { left:${t*a/4}px; }`;for(let t=1;t<=32;t++)e+=`.row${25*t} { top:${t*a/4}px; }`;for(let t=1;t<=100;t++)e+=`.kbdbg-inner.w${25*t} { width:${t*a/4+6}px; }`;for(let t=1;t<=28;t++)e+=`.kbdbg-inner.h${25*t} { height:${t*a/4+6}px; }`;for(let t=5;t<=32;t++)e+=`.w${25*t}>.plate { width:${t*a/4+6}px; }`;for(let t=5;t<=10;t++)e+=`.h${25*t}>.plate { height:${t*a/4+6}px; }`;addGlobalStyle(e)}function addGlobalStyle(e){var a,t;(a=document.getElementsByTagName("head")[0])&&((t=document.createElement("style")).type="text/css",t.innerHTML=e,a.appendChild(t))}function getElementAbsPos(e){var a=e.getBoundingClientRect();return{left:a.left+window.scrollX,top:a.top+window.scrollY}}var sound_key_set=new Audio("sound/key_set.wav");function ani_fly_button(e,a){var t=$("#keyboard-outline").find(".key-editing"),s=t.find(".key");if(t){var o=display_label(e,0),n=getElementAbsPos(s[0]);$("#fly-button").attr("style",`--fbs_left: ${a.left}px; --fbs_top: ${a.top}px;--fbe_left: ${n.left}px; --fbe_top: ${n.top}px;--fbcolor: ${t.css("color")};--fbbgcolor: ${t.css("background")};`),$("#fly-button").html(o.name).addClass("fly"),sound_key_set.pause(),sound_key_set.currentTime=0,sound_key_set.play()}}function update_share_url_panel(){var e;$("#share-dialog").hasClass("url-long")?(e=parseInt($("#share-dialog")[0].style.getPropertyValue("--aug-r")))<80&&(e++,$("#share-dialog")[0].style.setProperty("--aug-r",e+"px"),setTimeout("update_share_url_panel()",10)):((e=parseInt($("#share-dialog")[0].style.getPropertyValue("--aug-r")))>60&&(e=60),e>12&&(e--,$("#share-dialog")[0].style.setProperty("--aug-r",e+"px"),setTimeout("update_share_url_panel()",10)))}function lang_pre_action(){if(jslang=new Lang,Lang.prototype.attrList.push("data-tooltip","data-dropkind"),jslang.dynamic("en","lang/en.json"),jslang.dynamic("zh_cn","lang/zh_cn.json"),NOW_LANG=navigator.userLanguage||navigator.language||navigator.bowserLanguage,"zh-cn"===NOW_LANG.toLowerCase())NOW_LANG="zh_cn";else NOW_LANG="en";if(console4jslang=!0,null==window.location.href.match(/my.|18:2|0:8|console/g)?(console.log=()=>{},console4jslang=!1,$("#shorten-url").hide()):($("#c-output").show(),$("#shorten-url").text("Copy Keymap"),document.title="YDKB Dev"),-1!=window.location.href.indexOf("dev")){is_dev=1;var e=$(".brand-logo").html();$(".brand-logo").html(e.replace("Builder","Builder (DEV)")),$("nav").removeClass("uicolor").addClass("red")}console.log(layouts_save)}function lang_init(){(new Lang).init({defaultLang:"zh_sc"})}function onLangChange(e){NOW_LANG=e,window.jslang.change(e);var a=".lang-en",t=".lang-zh_sc";"zh_cn"==e&&([a,t]=[t,a]),$(a).show(),$(t).hide(),"zh_cn"!=e&&"en"!=e||(LANG_JSON_CONTENT.token&&LANG_JSON_CONTENT.token["lang-name"]==e?manual_update_lang():fetch(`lang/${e}.json`).then((function(e){if(e.ok)return e.json()})).then((function(e){LANG_JSON_CONTENT=e,manual_update_lang()}))),setTimeout((function(){tooltip_init(),update_logo_desc(),$("#key-set-tabs .indicator").html($("#key-set-tabs").find(".active")[0].innerHTML),$("#key-set-tabs").tabs("updateTabIndicator")}),500)}function manual_update_lang(){$("#keyboard-outline").find(".kbd-led").each((function(){var e=$(this).attr("class").match(/.*led(\d)/);if(e&&e[1]>7){var a=LANG_JSON_CONTENT.token[$(this).attr("data-tooltip")];a&&$(this).attr("data-tooltip",a)}})),$("#fn-set").find("a").each((function(){if(this.id.match(/_dropdown-btn/)){var e=LANG_JSON_CONTENT.token[$(this).attr("data-tooltip")];e&&$(this).attr("data-tooltip",e)}})),$("body").find("[lang-id]").each((function(){var e=$(this).attr("lang-id");if(e){var a=LANG_JSON_CONTENT.token[e+" #html"];a&&$(this).html(a);var t=LANG_JSON_CONTENT.token[e+" #title"];t&&$(this).attr("title",t);var s=LANG_JSON_CONTENT.token[e+" #tooltip"];s&&$(this).attr("data-tooltip",s)}}))}function LangChange(e){NOW_LANG!=e&&($("#layer_set").tabs("select","layer_0"),onLangChange(e))}function lang_from_json(e){let a=LANG_JSON_CONTENT.token[e];return a||(console.log(`${e} not found in json`),e)}LANG_JSON_CONTENT={},NOW_LANG="";