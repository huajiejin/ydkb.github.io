# 层概念(核心思想)

ydkb.io的固件最大支持8层按键，从 Layer 0 到 Layer 7

```mono text
    Keymap: 8 Layers                   Layer: 按键矩阵
    -----------------                   ---------------------
         ____________ 优先级                   _______________________
        /           / | 高                    / ESC / F1  / F2  / F3   ....
    7 /___________// |                      /-----/-----/-----/-----
    6 /___________// |                     / TAB /  Q  /  W  /  E   ....
    5 /___________/  |                    /-----/-----/-----/-----
    :   _:_:_:_:_:__ |               :   /LCtrl/  A  /  S  /  D   ....
    :  / : : : : : / |               :  /  :     :     :     :
    2 /___________// |               2 `--------------------------
    1 /___________// |               1 `--------------------------
    0 /___________/  V 低            0 `--------------------------
```   

> [!ydda] 理解和使用层时，重要的两点
>  - 开关状态
>  - 优先级

```ad-yddcol0
##### 层的开关状态
例如 Fn+1=F1，是通过打开层1再触发层1的按键来实现的: 
1. Fn(一般为L1)打开层1
2. 接着按下的按键1，在层1是设置的F1
3. 键盘输出按键F1
```

```ad-yddcol1
##### 层的优先级
层是有优先级的，层7最高。当按下一个按键时:
1. 从高往低找按键，找到打开的层
2. 如果该层未设置按键，继续往下查找到开启的层和按键。
3. 找到满足条件的按键，键盘输出该按键

```

举个例子说明一下优先级。比如打开了层4，然后在层4上用L2，L2虽然生效了且按下时打开了层2，但因为层4依然还是开启状态，它的优先级更高。所以层4对应位置有按键时，会触发的是层4的按键，而非层2的。(注：这个限制在2023.01.16后新固件里，不存在了)


## 新的层切换逻辑

在2023.01.16开始的固件里，根据这几年使用者的一些实际使用反馈。重新设计了整个层切换的逻辑。

```mindmap
> -a -vh 0.6
YDKB
  层切换
    瞬时开启层，优先层(按键时才有效)
      瞬时开启层
      瞬时开启层 | 层开关
      按键 | 瞬时开启层
      修饰键 & 瞬时开启层
    开关层(可保存状态)
      层开关
      瞬时开启层 | 层开关
      跳转到层
    默认层(一直开启的层)
      层0始终为开启
      设置默认层
```

层的逻辑有些变化，将所有层功能分成三个大类: 
- `瞬时开启层`，指必须按住按键时才会开启层 。只要按键放开，其状态就会恢复，不会保存。
- 瞬时开启的层也被设为优先层。此层有按键，则优先响应，其次才根据所有层状态从高往低查找。
- 使用`开关层`，层的状态是会保存，它不会被瞬时开启层关闭。
- 设置`默认层`，也会保存，但它不会被开关层或瞬时开启层关闭。层0始终为开启状态。

它不会破坏以往逻辑，但配合新的逻辑，符合更多人对于层切换的期望。例如：
1. 在使用瞬时开启L1时更期待触发的是层1按键。现在在更高层开启状态时，因为按住L1后层1是优先层，所以也可以触发层1上的按键。
2. 可以使用例如 L1+T1 来开启或关闭层1了，而不会因为最后L1松开又将层1关闭。因为现在瞬时开启层的状态变化不会影响到开关层。



