# BLE980M

|PCB | YANG |
|:--- |:--- |
|Firmware | YANG |
|Keymap Editor | YANG |
|Solder | YANG / 兰某人|
|Test | YANG / 兰某人|
|Seller | YANG |

安装可参看淘宝的说明：https://item.taobao.com/item.htm?id=616823708978

这是一个用于改装Leopold FC980M的转换器，可以将FC980M改装为支持USB和蓝牙4.0的双模键盘。改装不需要焊接。

大部分内容可以参看 BLE系列的使用说明，但是此转换器主控还是有一些特殊的地方，所以单独给它开一页说明。

注：本部分内容针对的是ydkb.io的最新版本固件。

固件的更新记录可见： [BLE980m 固件更新记录](changelog/ble980m)


## 蓝牙配对

蓝牙配对主要参看，[BLE双模使用](ble-series/)

简单说不需要单独启用配对模式，只要蓝牙处于未连接并且可发现状态，就可以配对。mac和ios的搜不到在上面文档里也有写处理方法，另外出现连接异常时，也有处理方法。


## 开关说明

要在未插USB线的时候使用蓝牙，首先确认电池开关是打开的。

安装后开关位于背面，这四个开关的作用不再是用来修改按键了。其他作用如下表

| DIP开关 | 作用 |
|:--- |:--- |
| 1| 电源开关(日常保持打开就行，即使晚上不用的时候)|
| 2| 刷机模式（拨到开再拨到关，键盘进入刷机模式）|
| 3和4 | 两者同时打开，等于重置蓝牙的短接（具体参考重置蓝牙的说明）| 

## 充电注意

USB数据线接口就是充电接口。

> [!ydda] 注意：建议使用电脑USB口或者正规的5v充电器来充电
> - 相比较其他一些BLE系列的，BLE980M的默认的充电电流能有750ma，所以保证供电充足下，充电速度也会更快一些的。
> - 如果使用支持快充或非合适充电器，充电电压过高或瞬时过高，可能损坏充电IC等。
> - 充电请使用不要高于5V的充电，有的带电源的HUB上的U口或者其他的充电器，可能高于5V。
> - 如果长期插电使用，建议拔掉电池或者至少将电池开关置于关闭。

BLE980M在充电时没有额外的指示灯，可以用文字输出电量，或者有的系统可以显示电量的那个，查看。

电量百分比显示，显示的是大概的水平，不是精确的，仅供参考（特别是充电时显示的误差会更大），每10%为一个等级。另外充电的过程中，电量显示为x1%，即比非充电时多显示1%。如下图是正在充电时显示的电量。  

## 固件更新

可以直接看这部分，[Mass Storage Device Bootloader（U盘模式）](bootloader/msd-bootloader)。但BLE980M在进入刷机模式和退出刷机模式时，有一些特殊。

##### 进入刷机模式的方法
有两个进入刷机模式的方法，一个是插上USB线后，将背面的DIP开关的2，拨到ON的一边，再拨回去，就行了。

推荐的是方法二：

> [!yddh] 软件进刷机模式方法
> - 在键盘能正常使用的时候，可以使用 **灯光和增强功能** 里的<kbd>Reset</kbd>，为了防止误按，当与<kbd>LCtrl</kbd>一起按的时候，也就是<kbd>LCtrl+Reset</kbd>，可以直接跳到刷机模式，这样就不需要去动背面的开关。
> - 正常使用键盘时，直接按 <kbd>LShift+RShift+LCtrl+B</kbd> 也可以进到刷机模式。 

##### 退出刷机模式的方法
在电脑里右键点击U盘，再选择弹出。如果你是在没有数据线时误按让键盘进了刷机模式，那么把背面的开关1，关闭再重新打开，以此来退出刷机模式。

## 指示灯说明以及节能

键盘原来自带的三颗指示灯，普通的功能可以通过 [LEDMAP](features/ledmap) 定义。指示灯仅在键盘未节能时亮起，建议不要设置需要经常常亮的指示，每颗指示灯一直亮起增加的耗电，会减少键盘的续航。

BLE980M控制器上面本身带有一颗指示灯，在开关位置，从背面或者键盘支起时从侧面可以看到。这个灯属于一般用不上的，目前它的作用：

| BLE980M控制器开关处指示灯 | LED指示方式 |
|:--- |:--- |
| 刷机模式（空闲） | 一直闪烁 |
| 刷机模式（数据写入） | 快速闪烁 |
| 键盘每次启动的时候 | 先亮一下，再灭掉。用来指示键盘有正常启动。 |

除了定义的功能外，还有特殊作用。为了方便说明，正面三个指示灯从左到右，标为LED1 LED2 LED3。

| 状态或操作 | BLE980M 正面LED指示方式 |
|:--- |:--- |
| 启动时蓝牙 未连接 状态指示 | LED3闪烁，如果一直未连接，约15秒左右会停止闪烁 |
| 启动时蓝牙 已连接 状态指示 | LED2和LED3同时较慢闪。每次亮的时间明显长于灭的时间。 |
| 按键<key>LShift+RShift+s</key> | 按上面的方式指示蓝牙连接状态 |
| 手动进入节能 | 三个灯同时亮起，然后再按LED3 LED2 LED1的顺序依次熄灭 |
| 从二级节能唤醒 | 重新开始指示蓝牙连接状态 |
| 低电量提示 | BLE980M本身不会提示，但是如果是连接到的win10电脑，win10电脑会提示设备电量低（5%），请尽快充电 |
| 极低电量提示 | 第一个指示灯会快速闪烁，这时键盘偶尔输入也会出错了，请一定充电 | 

![](assets/980m_low_battery_win10.png)

BLE980M的这个转换器，节能也有一些特殊的地方，目前的设计如下：
  1. 键盘闲置3秒没按任何按键后，进入一级节能，只是BLE980M的转换器主控节能，FC980M键盘不会节能，只要检测到FC980M有按键就立即唤醒。
  2. 键盘如果90秒蓝牙未连接，或者闲置时间超过2.5小时，这时蓝牙会关闭并断开，进入二级节能，二级节能时会关断FC980M的供电，从二级节能唤醒，需要将键盘前端抬起一定的角度。
  3. 使用Power Save按键，可以直接进入二级节能。
  4. BLE980M没有Lock Mode。


## 异常处理

工作中要是出现异常，首先请尝试关闭dip的开关1然后重新打开，让键盘重启看是否正常工作。

如果有配对后使用的问题，只要有线还能使用，那么，首先用文字输出电量功能，看一下输出的数字是多少。如果是44或45，可能需要重置蓝牙。如果是12，那么是因为蓝牙功能关闭了，重新打开，见蓝牙开关和连接状态。

以及请先参看 [BLE系列排错指南](ble-series/troubleshooting)。

遇到bug可以通过群里联系等方式报给我。